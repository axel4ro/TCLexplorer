<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- üî• Ajustat pentru mobile sƒÉ facƒÉ zoom-out -->
  <meta name="viewport" content="width=device-width, initial-scale=0.85, minimum-scale=0.5, maximum-scale=1.0, user-scalable=yes" />
  <title>The Cursed Land</title>

	  <!-- iOS PWA support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TCL Explorer">

  <!-- Icon pentru Home Screen -->
  <link rel="apple-touch-icon" href="images/tcl_icon.png" sizes="180x180">

  <!-- Manifest pentru Android/Chrome -->
  <link rel="manifest" href="manifest.json">

  <meta name="theme-color" content="#249c8c">
  <style>
  
:root {
  --bg-dark: #161a24;
  --text-dark: #f1f1f1;
  --card-dark: #161a24;
}
/* BODY */
body {
  font-family: Arial, sans-serif;
  margin: 20px auto;
  padding: 0 20px;
  max-width: 1000px;
  line-height: 1.6;
  background-color: var(--bg-dark);
  color: var(--text-dark);
  overflow-x: auto;
  -webkit-text-size-adjust: none;
}

.nav-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1100;
  background: #161a24;
  padding: 8px 0;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.nav-bar-inner {
  max-width: 1000px;  /* aceea»ôi limitƒÉ ca body */
  margin: 0 auto;
  padding: 0 20px;    /* acelea»ôi margini ca body */
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  box-sizing: border-box;
}

/* Menu centrat */
#menuToggle {
  padding: 10px 18px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  background: #249c8c;
  color: white;
  font-weight: 600;
  cursor: pointer;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}
#menuToggle:hover { 
  opacity: 0.9; 
  transform: translateY(-2px);
}


#menuToggle {
  padding: 10px 18px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  background: #249c8c;
  color: white;
  font-weight: 600;
  cursor: pointer;

  /* üî• umbra textului »ôi a butonului */
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
}

#menuToggle:hover { 
  opacity: 0.9; 
  transform: translateY(-2px);
}

/* PANEL MENIU cu anima»õie */
.menu-panel {
  position: fixed;
  top: 48px;
  left: 0;
  width: 100%;
  background: rgba(22,26,36,0.97);
  z-index: 1090;
  padding: 0 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);

  transform: scaleY(0);          /* üî• ascuns */
  transform-origin: top;         /* se deschide √Æn jos */
  transition: transform 0.2s ease; /* mult mai rapid dec√¢t 0.3s */
  max-height: none;              /* eliminƒÉm limitarea greoaie */
  overflow-y: hidden;
}

.menu-panel.open {
  transform: scaleY(1);          /* üî• se afi»ôeazƒÉ */
  overflow-y: auto;
}

/* scroll bar vizibil */
.menu-panel::-webkit-scrollbar { width: 10px; }
.menu-panel::-webkit-scrollbar-track { background: #222; border-radius: 6px; }
.menu-panel::-webkit-scrollbar-thumb { background: #555; border-radius: 6px; }
.menu-panel::-webkit-scrollbar-thumb:hover { background: #888; }

.menu-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 2 coloane */
  gap: 12px 20px; /* spa»õiu √Æntre butoane pe r√¢nduri »ôi coloane */
  justify-content: center;  /* üî• centreazƒÉ tot grid-ul */
  justify-items: center;    /* üî• centreazƒÉ butoanele √Æn celulƒÉ */
  max-width: 450px;         /* üî• limiteazƒÉ lƒÉ»õimea totalƒÉ */
  margin: 0 auto;           /* üî• centreazƒÉ pe paginƒÉ */
  padding: 20px 0;
  max-height: 2500px;
  overflow-y: auto;
  scrollbar-width: none;
}

.menu-buttons::-webkit-scrollbar {
  display: none;
}
.menu-buttons button {
  width: 200px;
  max-width: 90%;
  scroll-snap-align: center;
  text-align: center;
  padding: 16px;
  border-radius: 50px;
  background: #249c8c;
  color: #fff;
  font-weight: 700;
  font-size: 18px;
  transition: transform 0.2s, opacity 0.2s;
  transform-origin: center;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8), 
               -1px -1px 2px rgba(0, 0, 0, 0.6);
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.5);
}
.menu-buttons button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.6);
}


#chart.fullpage {
  position: fixed;
  top: 60px; /* c√¢t are nav-ul */
  left: 0;
  width: 100%;
  height: calc(100% - 60px);
  margin: 0;
  padding: 0;
  z-index: 500;
  background: var(--bg-dark);
}
#chart.fullpage iframe {
  width: 100%;
  height: 100%;
  border: none;
}

#xexchangeIframe.fullpage {
  position: fixed;
  top: 60px;
  left: 0;
  width: 100%;
  height: calc(100% - 60px);
  margin: 0;
  padding: 0;
  z-index: 500;
  background: var(--bg-dark);
}
#xexchangeIframe.fullpage iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* Carduri evenimente */
.event-card {
  border-radius: 12px;
  padding: 14px 16px;
  margin-bottom: 14px;
  background: #0c1320;
  color: #0c1320);
  border: 1px solid #2ff6de33 !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  transition: all 0.2s ease;
}
.event-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
/* Buton Info din card */
.event-card button {
  transition: background 0.2s;
}
.event-card button:hover {
  background:#0c1320;
}

.event-title {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 4px;
}
.event-desc {
  font-size: 14px;
  margin-bottom: 6px;
  color: #a1a1aa;
}
.event-status {
  font-size: 13px;
  font-weight: 600;
}

/* Status colors */
.event-status.active { border-left: 6px solid #10b981; }
.event-status.upcoming { border-left: 6px solid #facc15; }
.event-expired { border-left: 6px solid #ef4444 !important; }

/* Stil pentru tabelul de staking */
#stakingTable {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto;
  border: 2px solid #444; /* grosime pe marginea tabelului */
}

#stakingTable th, 
#stakingTable td {
  padding: 8px;
  text-align: center;
  white-space: nowrap;
  border-right: 1px solid #555; /* linii sub»õiri verticale */
}

#stakingTable th:last-child,
#stakingTable td:last-child {
  border-right: none; /* scoatem linia dupƒÉ ultima coloanƒÉ */
}

#stakingTable thead tr {
  border-bottom: 3px solid #007bff; /* linie groasƒÉ sub header */
}

#stakingTable tbody tr {
  border-bottom: 2px solid #333; /* linii groase √Æntre r√¢nduri */
}

#stakingTable tbody tr:last-child {
  border-bottom: none; /* scoatem ultima linie de jos */
}


/* Titluri »ôi sec»õiuni */
h2 {
  color: #0d6efd;
  margin-bottom: 8px;
}
.section {
  margin-bottom: 24px;
}

/* Inputuri */
input[type="text"] {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin-top: 4px;
  background-color: var(--card-dark);
  border: 1px solid #444;
  border-radius: 8px;
  color: #fff;
}

/* HIDE/SHOW SECTIONS */
.section-page {
  display: none;
  padding-top: 40px; /* üî• ajustat sƒÉ lase doar c√¢t trebuie sub naviga»õie */
}
.section-page.active {
  display: block;
}

/* chart special: full screen fƒÉrƒÉ padding */
#chart.fullpage {
  position: fixed;
  top: 60px; /* c√¢t are nav-ul */
  left: 0;
  width: 100%;
  height: calc(100% - 60px);
  margin: 0;
  padding: 0;  /* eliminƒÉm paddingul */
  z-index: 500;
  background: var(--bg-dark);
}

#explorerIframe.fullpage {
  position: fixed;
  top: 60px;
  left: 0;
  width: 100%;
  height: calc(100% - 60px);
  margin: 0;
  padding: 0;
  z-index: 500;
  background: var(--bg-dark);
}
#explorerIframe.fullpage iframe {
  width: 100%;
  height: 100%;
  border: none;
}

/* Butoane */
button {
  padding: 10px 20px;
  background-color: #007bff;
  color: white;
  border: none;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
}
button:hover { opacity: 0.9; }

/* Rezultate */
.result {
  margin-top: 20px;
  background: var(--card-dark);
  border-left: 6px solid #28a745;
  padding: 16px;
  white-space: pre-wrap;
  font-size: 15px;
  border-radius: 8px;
}

/* Alte layouturi */
.row-group { display: flex; gap: 16px; }
.row-group > div { flex: 1; }

.action-row {
  display:flex;
  gap:12px;
  align-items:center;
  margin-top:12px;
}
.btn-trade {
  display:inline-block;
  padding:10px 20px;
  border-radius:8px;
  text-decoration:none;
  background:#2ff6de;
  color:#090909;
  font-size:16px;
  font-weight:600;
}
.btn-trade:hover { opacity:.9; }

.stats-row { display:flex; gap:16px; flex-wrap:wrap; }
.stat {
  flex:1;
  padding:10px 12px;
  border:1px solid #444;
  border-radius:10px;
  background: var(--card-dark);
  min-width:160px;
}
.stat-top {
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:13px;
  color:#6b7280;
}
.stat-value {
  font-size:18px;
  font-weight:700;
  margin-top:6px;
}

/* Overlay imagine fullscreen */
.overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9);
  z-index: 3000;
  align-items: center;
  justify-content: center;
}

.overlay-img {
  max-width: 95%;
  max-height: 90%;
  border-radius: 12px;
  transition: transform 0.25s ease;
  cursor: zoom-out;
}

/* Buton √Ænchidere */
.close {
  position: absolute;
  top: 15px;
  right: 25px;
  color: #fff;
  font-size: 36px;
  font-weight: bold;
  cursor: pointer;
}

/* Desktop: grid 3 coloane */
@media (min-width: 769px) {
  .token-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }
}


.lang-dropdown {
  position: absolute;
  right: 20px;
  top: 8px;
  z-index: 2000;
}

.lang-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 14px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 12px;
  border: 2px solid #2ff6de;
  background: linear-gradient(135deg, #1f2937, #111827);
  color: #f1f1f1;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(47, 246, 222, 0.25);
}

.lang-btn img {
  width: 20px;
  height: 14px;
  border-radius: 2px;
}

.lang-menu {
  display: none;
  position: absolute;
  right: 0;
  margin-top: 6px;
  background: #111827;
  border: 1px solid #2ff6de;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  min-width: 160px;
}

.lang-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  font-size: 14px;
  cursor: pointer;
  color: #f1f1f1;
}

.lang-option img {
  width: 20px;
  height: 14px;
  border-radius: 2px;
}

.lang-option:hover {
  background: #2ff6de33;
}
.lang-dropdown.open .lang-menu {
  display: block;
}

.highlight-row {
  background: rgba(47,246,222,0.25) !important;
  transition: background 0.5s ease;
}

/* Responsive */
@media (max-width: 768px) {
  body { margin: 20px 12px; }
  .row-group { flex-direction: column; }
  h2 { font-size: 20px; }
  input[type="text"], button { font-size: 15px; }
  .stats-row{ flex-direction:column; }
}

/* Dexscreener aspect ratio */
#dexscreener-embed { position:relative; width:100%; padding-bottom:125%; }
@media(min-width:1400px){ #dexscreener-embed{padding-bottom:65%;} }
#dexscreener-embed iframe { position:absolute; width:100%; height:100%; top:0; left:0; border:0; }

/* Grid doar pe mobil pentru token stats */
@media (max-width: 768px) {
  .token-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }
  .token-grid .stat {
    grid-column: span 1;
  }
}
/* 3 coloane pentru Initial Liquidity */
.init-liq {
  display: flex;
  flex-wrap: nowrap;
  gap: 16px;
  margin-top: 24px; /* üî• spa»õiu deasupra */
}

.init-liq .stat {
  flex: 1 1 calc(33.333% - 16px);
  min-width: 0;
}
.section.init-liq-section {
  margin-top: 32px; /* üî• spa»õiu vizibil √Æntre Live Data »ôi Initial Liquidity */
}


/* ‚ö° Suprascriem regula pe mobil doar pentru init-liq */
@media (max-width: 768px) {
  .init-liq {
    flex-direction: row !important;
  }
}

.install-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  font-size: 14px;
  font-weight: 600;
  border-radius: 10px;
  border: 2px solid #2ff6de;
  background: linear-gradient(135deg, #1f2937, #111827);
  color: #f1f1f1;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(47, 246, 222, 0.25);
  text-decoration: none;   /* üî• eliminƒÉ sublinierea */
}
.install-btn:hover {
  background: #2ff6de33;
  text-decoration: none;   /* üî• se asigurƒÉ cƒÉ nici la hover nu apare */
}


/* === LIVE indicator corect === */
.live-dot {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 700;
  color: #12e193;
  background: rgba(18,225,147,0.12);
  padding: 6px 6px;
  border-radius: 999px;
  vertical-align: middle;
}

.live-dot::before {
  content: "";
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #12e193;
  box-shadow: 0 0 0 rgba(47,246,222, 0.7);
  animation: pulseDot var(--pulse-speed, 2s) infinite ease-in-out;
}

/* üí´ Puls animat */
@keyframes pulseDot {
  0% {
    box-shadow: 0 0 0 0 rgba(47,246,222, 0.6);
    transform: scale(1);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(47,246,222, 0);
    transform: scale(1.25);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(47,246,222, 0);
    transform: scale(1);
  }
}

#redeemAlpha .event-card {
  background: #111923;
  border-left: 4px solid #2ff6de;
}

/* === GRID SPECIAL pentru Staking === */
.staking-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 15px;
}

@media (max-width: 900px) {
  .staking-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

.staking-grid .stat {
  padding: 12px;
  border: 1px solid #333;
  border-radius: 10px;
  background: #161a24;
  text-align: center;
  transition: 0.2s ease;
}

.staking-grid .stat:hover {
  transform: translateY(-2px);
  border-color: #2ff6de;
}

/* === Ultimul card = Calculator Button === */
.staking-grid .calc-card {
  cursor: pointer;
  background: linear-gradient(135deg, #0d9488, #065f46);
  color: #fff;
  font-weight: 700;
  display: flex;
  flex-direction: column;
  justify-content: center;
  transition: 0.25s ease;
}

.staking-grid .calc-card:hover {
  background: linear-gradient(135deg, #14b8a6, #047857);
  transform: translateY(-3px);
}

/* === Modal (popup) === */
#aprModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 5000;
  align-items: center;
  justify-content: center;
}

#aprModal .modal-content {
  background: #161a24;
  border: 2px solid #2ff6de;
  border-radius: 14px;
  padding: 20px 28px;
  width: 90%;
  max-width: 400px;
  color: #f1f1f1;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
  position: relative;
  text-align: center;
  animation: popupFade 0.3s ease;
}

@keyframes popupFade {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

#aprModal input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #333;
  margin-top: 8px;
  font-size: 16px;
  background: #111827;
  color: #fff;
}

#aprModal button {
  margin-top: 12px;
  padding: 10px 20px;
  border-radius: 8px;
  border: none;
  background: #2ff6de;
  color: #000;
  font-weight: 700;
  cursor: pointer;
}

#aprModal .close {
  position: absolute;
  top: 10px;
  right: 15px;
  color: #2ff6de;
  font-size: 22px;
  cursor: pointer;
}
.sentiment-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px auto 25px;
  gap: 20px;
  flex-wrap: wrap;
}

.mini-stat {
  background: #0c1320;
  border: 1px solid #2ff6de33;
  border-radius: 12px;
  padding: 10px 14px;
  text-align: center;
  flex: 1;
  min-width: 160px;
  max-width: 260px;
  box-shadow: 0 0 8px rgba(47, 246, 222, 0.08);
}

.mini-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #6b7280;
  font-size: 12px;
  margin-bottom: 4px;
}

.mini-value {
  font-size: 18px;
  font-weight: 700;
}

.mini-sub {
  font-size: 13px;
  color: #9ca3af;
}

/* Sentiment box fixat pe centru */
#sentimentBox {
  background: #0c1320;
  border: 1px solid #2ff6de33;
  border-radius: 12px;
  padding: 10px 8px 14px;
  text-align: center;
  flex: 1;
  max-width: 260px;
  box-shadow: 0 0 8px rgba(47, 246, 222, 0.08);
}

#sentimentBox h3 {
  color: #2ff6de;
  margin: 0;
  font-size: 14px;
  font-weight: 600;
}

#sentimentScore {
  font-size: 22px;
  font-weight: 800;
  margin-top: 4px;
}

#sentimentLabel {
  font-size: 13px;
  font-weight: 600;
  color: #a1a1aa;
}

/* Responsivitate (mobile) */
@media (max-width: 768px) {
  .sentiment-row {
    flex-direction: column;
    align-items: center;
  }
  .mini-stat, #sentimentBox {
    max-width: 300px;
    width: 100%;
  }
}
/* === Uniformizare stil carduri principale cu cele de sus === */
.token-grid .stat {
  background: #0c1320 !important;
  border: 1px solid #2ff6de33 !important;
  border-radius: 12px;
  box-shadow: 0 0 8px rgba(47, 246, 222, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.token-grid .stat:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px rgba(47, 246, 222, 0.15);
}
/* === Uniformizare »ôi pentru Initial Liquidity === */
.init-liq .stat {
  background: #0c1320 !important;
  border: 1px solid #2ff6de33 !important;
  border-radius: 12px;
  box-shadow: 0 0 8px rgba(47, 246, 222, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.init-liq .stat:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px rgba(47, 246, 222, 0.15);
}
/* === Uniformizare »ôi pentru Top Staking Leaderboard === */
.staking-grid .stat {
  background: #0c1320 !important;
  border: 1px solid #2ff6de33 !important;
  border-radius: 12px;
  box-shadow: 0 0 8px rgba(47, 246, 222, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.staking-grid .stat:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px rgba(47, 246, 222, 0.15);
}
#sentimentScore {
  transition: transform 0.1s ease;
}

  </style>
</head>
<body>
<!-- NAVIGATION -->
<div class="nav-bar">
  <div class="nav-bar-inner">
    
    <!-- üî• container pentru Install Guide -->
    <div id="installGuideContainer" style="position:absolute; left:20px; top:8px;"></div>

    <!-- Menu centrat -->
    <button id="menuToggle">‚ò∞ Menu</button>

    <!-- LimbƒÉ dreapta -->
    <div class="lang-dropdown">
      <button class="lang-btn" id="currentLang">
        <img src="https://flagcdn.com/w20/gb.png" alt="EN"> English
      </button>
      <div class="lang-menu">
        <div class="lang-option" onclick="setLang('en')"><img src="https://flagcdn.com/w20/gb.png"> English</div>
        <div class="lang-option" onclick="setLang('ro')"><img src="https://flagcdn.com/w20/ro.png"> Rom√¢nƒÉ</div>
        <div class="lang-option" onclick="setLang('tr')"><img src="https://flagcdn.com/w20/tr.png"> T√ºrk√ße</div>
        <div class="lang-option" onclick="setLang('de')"><img src="https://flagcdn.com/w20/de.png"> Deutsch</div>
        <div class="lang-option" onclick="setLang('es')"><img src="https://flagcdn.com/w20/es.png"> Espa√±ol</div>
        <div class="lang-option" onclick="setLang('fr')"><img src="https://flagcdn.com/w20/fr.png"> Fran√ßais</div>
        <div class="lang-option" onclick="setLang('it')"><img src="https://flagcdn.com/w20/it.png"> Italiano</div>
        <div class="lang-option" onclick="setLang('pl')"><img src="https://flagcdn.com/w20/pl.png"> Polski</div>
        <div class="lang-option" onclick="setLang('pt')"><img src="https://flagcdn.com/w20/pt.png"> Portugu√™s</div>
      </div>
    </div>
  </div>
</div>


<!-- MENU PANEL -->
<div id="menuPanel" class="menu-panel">
  <div class="menu-buttons">

<button onclick="openWiki()" id="btn-wiki">üìñ Wiki</button>
<button onclick="openNFTs()" id="btn-nfts">üñºÔ∏è NFTs Explorer</button>

<button onclick="showPage('web3Guide')" id="btn-web3Guide">
  ‚ÑπÔ∏è Web3 Guides
</button>

    <button onclick="showPage('token')" id="btn-token" class="active">
  <img src="https://axel4ro.github.io/TCLexplorer/images/tcl_icon.png" 
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  TCL Token
</button>

    <button onclick="showPage('calculator')" id="btn-calculator" class="active">
  <img src="https://axel4ro.github.io/TCLexplorer/images/calculator.png" 
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  Calculator
</button>

    <button onclick="showPage('chart')" id="btn-chart">üìä Chart</button>
	<button onclick="showPage('events')" id="btn-events">üìÖ Events</button>
	<button onclick="showPage('staking')" id="btn-staking">üèÜ Top Staking</button>
	<button onclick="showPage('walletCheck')" id="btn-walletCheck">üîé Wallet Check</button>
	
	    <button onclick="showPage('explorerIframe')" id="btn-explorerIframe" class="active">
  <img src="https://axel4ro.github.io/TCLexplorer/images/EGLD.png"
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  MvX Explorer
</button>

    <button onclick="showPage('xexchangeIframe')" id="btn-xexchangeIframe" class="active">
  <img src="https://axel4ro.github.io/TCLexplorer/images/exchange.png"
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  xExchange ‚Üó
</button>
	
	
<button onclick="openLander()" id="btn-Lander">
  <img src="https://axel4ro.github.io/TCLexplorer/images/lander.png"
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  Lander ‚Üó
</button>


<button onclick="openXPortal()" id="btn-xportal">
  <img src="https://axel4ro.github.io/TCLexplorer/images/xPortal.png"
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  xPortal ‚Üó
</button>

<button onclick="openTCL()" id="btn-TCL">
  <img src="https://axel4ro.github.io/TCLexplorer/images/thecursedland.png"
       style="width:20px; height:20px; margin-right:6px; vertical-align:middle;">
  The Cursed Land ‚Üó
</button>

    <!-- po»õi adƒÉuga oric√¢te vrei -->
  </div>
</div>

 <!-- Token -->
<div id="token" class="section-page">   <!-- ‚ùå fƒÉrƒÉ active -->
  <h2 style="display:flex; align-items:center; gap:8px;">
  <img src="https://axel4ro.github.io/TCLexplorer/images/tcl_icon.png" alt="TCL" style="width:28px; height:28px; border-radius:6px;">
  TCL Token
</h2>
  <div class="section">
    <strong><span class="live-dot">LIVE DATA</span></strong>
    <span style="font-size: 13px; color: #0d6efd; display:block; margin-top:10px;">
      üìä Data is fetched live from the MultiversX Blockchain (DexScreener & CoinGecko)
    </span>
  </div>
<!-- üß† TCL Sentiment + Staking Stats -->
<div class="sentiment-row">
  <!-- üîπ Left: Total Staked -->
  <div class="mini-stat">
    <div class="mini-top">
      <span>Total TCL Staked</span><span class="live-dot"></span>
    </div>
    <div id="stakedMini" class="mini-value">‚Äî</div>
    <div id="stakedMiniUsd" class="mini-sub">‚âà ‚Äî $</div>
  </div>

  <!-- üî∏ Center: Sentiment Gauge -->
<div id="sentimentBox">
  <h3 data-i18n="sentiment_title">Sentiment Index</h3>
  <canvas id="sentimentGauge" width="160" height="80"></canvas>
  <div id="sentimentScore">--</div>
  <div id="sentimentLabel" data-i18n="sentiment_loading">Loading...</div>
</div>

  <!-- üîπ Right: Emission/Day -->
  <div class="mini-stat">
    <div class="mini-top">
      <span>Current Emission/Day</span><span class="live-dot"></span>
    </div>
    <div id="emissionMini" class="mini-value">‚Äî</div>
    <div id="emissionMiniUsd" class="mini-sub">‚âà ‚Äî $</div>
  </div>
</div>


  <!-- üî• Toate cardurile live -->
  <div class="stats-row token-grid">
    <div class="stat">
      <div class="stat-top">
        <span>Current Price</span><span class="live-dot"></span>
      </div>
      <div id="curPrice" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>24h Change</span><span class="live-dot"></span>
      </div>
      <div id="change24h" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>ATH</span><span class="live-dot"></span>
      </div>
      <div id="ath" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>ATL</span><span class="live-dot"></span>
      </div>
      <div id="atl" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>TCL Supply</span><span class="live-dot"></span>
      </div>
      <div id="curTCL" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>USDC Supply</span><span class="live-dot"></span>
      </div>
      <div id="curUSDC" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>Market Cap</span><span class="live-dot"></span>
      </div>
      <div id="marketCap" class="stat-value">‚Äî</div>
    </div>
		    <div class="stat">
      <div class="stat-top">
        <span>Burned TCL</span><span class="live-dot"></span>
      </div>
      <div id="burned" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>Holders</span><span class="live-dot"></span>
      </div>
      <div id="holders" class="stat-value">‚Äî</div>
    </div>
    <div class="stat">
      <div class="stat-top">
        <span>Circulating Supply</span><span class="live-dot"></span>
      </div>
      <div id="circulating" class="stat-value">‚Äî</div>
    </div>
	<div class="stat">
  <div class="stat-top">
    <span>Current Supply</span><span class="live-dot"></span>
  </div>
  <div id="currentSupply" class="stat-value">‚Äî</div>
</div>
	<div class="stat">
	  <div class="stat-top">
		<span>TCL Max Supply</span><span class="live-dot"></span>
	  </div>
	  <div id="supply" class="stat-value">‚Äî</div>
	</div>
	<div class="stat">
  <div class="stat-top">
    <span>Volume (24h)</span><span class="live-dot"></span>
  </div>
  <div id="volume24h" class="stat-value">‚Äî</div>
</div>
<div class="stat">
  <div class="stat-top">
    <span>Trades Count</span><span class="live-dot"></span>
  </div>
  <div id="tradesCount" class="stat-value">‚Äî</div>
</div>
	    <div class="stat">
      <div class="stat-top">
        <span>Transactions</span><span class="live-dot"></span>
      </div>
      <div id="transactions" class="stat-value">‚Äî</div>
    </div>
  </div> <!-- ‚úÖ √Ænchis grid-ul aici -->

  <!-- Initial Liquidity separat -->
<div class="section init-liq-section">
  <strong><span>Initial Liquidity (Listing)</span></strong>
  <div class="stats-row init-liq">
    <div class="stat">
      <div class="stat-top"><span>Initial Price</span></div>
      <div class="stat-value">0.006 $</div>
    </div>
    <div class="stat">
      <div class="stat-top"><span>TCL Supply</span></div>
      <div class="stat-value">4,000,000</div>
    </div>
    <div class="stat">
      <div class="stat-top"><span>USDC Supply</span></div>
      <div class="stat-value">25,000 $</div>
    </div>
  </div>
</div>


<!-- How to Earn TCL (Whitepaper) -->
<div class="section">
  <strong><span>üìñ How to Earn TCL</span></strong>
  <div style="margin-top:12px; border:1px solid #333; border-radius:12px; overflow:hidden; background:#161a24;">
    <img 
      src="https://whitepaper.thecursedland.com/~gitbook/image?url=https%3A%2F%2F1088796652-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252FNfwQqA3PjlWwIAbvldOU%252Fuploads%252FVZ0W5PmUUiOq7abWcmm8%252Fearn%2520tcl.jpg%3Falt%3Dmedia%26token%3D156219ff-cec6-4bb6-8710-f8f11b8cc520&width=768&dpr=4&quality=100&sign=bbb5e8e&sv=2" 
      alt="How to Earn TCL - Whitepaper"
      style="width:100%; height:auto; display:block; border-radius:12px; cursor:zoom-in;"
      loading="lazy"
      onclick="openImage(this.src)"
    />
  </div>
  <small style="color:#6b7280; display:block; margin-top:8px; font-size:13px;">
    üîó Source: 
    <a href="https://whitepaper.thecursedland.com/tokenomics/how-to-earn-tcl" 
       target="_blank" 
       style="color:#2ff6de; text-decoration:none; font-weight:600;">
       The Cursed Land Whitepaper</a>
  </small>
</div>
  </div>

<!-- xExchange Trade -->
<div id="xexchangeIframe" class="section-page">
  <iframe 
    src="https://xexchange.com/trade?firstToken=USDC-c76f1f&secondToken=TCL-fe459d"
    style="width:100%;height:100%;border:0;">
  </iframe>
</div>

  <!-- Calculator -->
  <div id="calculator" class="section-page">
<h2 data-i18n="calc_title"></h2>
<div class="row-group">
  <div style="flex: 2;">
    <label id="inputLabel" data-i18n="calc_label_buy"></label>
    <input type="text" id="amount" placeholder="ex: 100" onblur="formatInputField(this)" />
  </div>
  <div style="flex: 1; display: flex; align-items: flex-end;">
    <button onclick="switchMode()" id="switchBtn" data-i18n="calc_switch_to_sell"></button>
  </div>
</div>
<div class="action-row">
  <button style="background-color:#28a745;" onclick="calculate()" data-i18n="calc_btn_calculate"></button>
  <button class="btn-trade" onclick="showPage('xexchangeIframe')" data-i18n="calc_btn_trade"></button>
</div>
<div class="result" id="resultBox"></div>
</div>

<!-- üåê Web3 Guide -->
<div id="web3Guide" class="section-page">
  <h2 data-i18n="web3_title">üåê Web3 Guides</h2>
  <p data-i18n="web3_desc" style="color:#a1a1aa; font-size:15px;">
    Connect your wallet, redeem rewards and explore all Web3 integrations of The Cursed Land.
  </p>

  <!-- Connect xPortal -->
  <div class="event-card">
    <div class="event-title" data-i18n="web3_connect_title">üîó Connect xPortal</div>
    <div class="event-desc" data-i18n="web3_connect_desc">
      Learn how to connect your <b>xPortal Wallet</b> and more.
    </div>
    <button onclick="showSubGuide('connectXportal')" style="background:#2ff6de;color:#000;" data-i18n="web3_connect_btn">Open Tutorial</button>
  </div>

  <!-- Redeem Œ± Voucher -->
  <div class="event-card">
    <div class="event-title" data-i18n="web3_alpha_title">üíé Redeem Œ± Voucher</div>
    <div class="event-desc" data-i18n="web3_alpha_desc">
      Redeem your in-game <b>Œ± Voucher</b> to receive <b>Alpha Tokens ($SN114)</b> from Subnet Level 114 on the Bittensor Blockchain.
    </div>
    <button onclick="showSubGuide('redeemAlpha')" style="background:#2ff6de;color:#000;" data-i18n="web3_alpha_btn">Open Tutorial</button>
  </div>

  <!-- Future items -->
  <div class="event-card">
    <div class="event-title" data-i18n="web3_soon_title">üß† More Coming Soon...</div>
    <div class="event-desc" data-i18n="web3_soon_desc">Staking, swapping, and more.</div>
  </div>
</div>

<!-- Events -->
<div id="events" class="section-page">
  <h2 data-i18n="events_title"></h2>
  <small style="color:#6b7280; display:block; margin-bottom:10px; font-size:13px;" data-i18n="events_desc"></small>

  <div id="eventContainer" data-i18n="events_loading"></div>

  <div style="margin-top:15px; display:flex; gap:6px; flex-wrap:wrap;" id="eventButtons"></div>
</div>



<!-- TCL Token Chart -->
<div id="chart" class="section-page">
  <iframe 
    src="https://dexscreener.com/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff?embed=1&loadChartSettings=0&tabs=0&info=0&chartLeftToolbar=0&chartDefaultOnMobile=1&chartTheme=dark&theme=dark&chartStyle=1&chartType=usd&interval=15">
  </iframe>
</div>

  <!-- Explorer MultiversX -->
<div id="explorerIframe" class="section-page">
  <iframe 
    src="https://explorer.multiversx.com/tokens/TCL-fe459d"
    style="width:100%;height:100%;border:0;">
  </iframe>
</div>

<!-- Staking -->
<div id="staking" class="section-page">
  <h2>üèÜ TCL top 100 Staking - Leaderboard</h2>
  <small id="lastUpdated" style="color:#6b7280; display:block; margin-bottom:10px; font-size:13px;">
    ‚è≥ Loading update time...
  </small>
<!-- üî• TCL Rewards Stats Row (cu valori √Æn $ »ôi buton calculator) -->
<div id="stakingStats" class="staking-grid">
  <div class="stat">
    <div class="stat-top">
      <span>Total TCL Staked</span><span class="live-dot"></span>
    </div>
    <div id="staked" class="stat-value">‚Äî</div>
    <div id="stakedUsd" style="font-size:13px; color:#9ca3af; margin-top:4px;">‚âà ‚Äî $</div>
  </div>

  <div class="stat">
    <div class="stat-top">
      <span>Current Emission/Day</span><span class="live-dot"></span>
    </div>
    <div id="emission" class="stat-value">‚Äî</div>
    <div id="emissionUsd" style="font-size:13px; color:#9ca3af; margin-top:4px;">‚âà ‚Äî $</div>
  </div>

  <div class="stat">
    <div class="stat-top">
      <span>APR</span><span class="live-dot"></span>
    </div>
    <div id="apr" class="stat-value">‚Äî</div>
    <div id="aprUsd" style="font-size:13px; color:#9ca3af; margin-top:4px;">‚Äî</div>
  </div>

<div class="stat calc-card" onclick="openAprCalculator()">
  <div class="stat-top" style="justify-content:center; color:#fff;">
    <span>üßÆ APR Calculator</span>
  </div>
</div>

</div>

<!-- üíé APR Calculator Modal -->
<div id="aprModal">
  <div class="modal-content">
    <span class="close" onclick="closeAprCalculator()">‚úñ</span>
    <h3 style="margin-top:0;">APR Simulator</h3>
    <p style="font-size:14px; color:#9ca3af;">Enter an amount of TCL to simulate new APR:</p>
    <input 
  type="text" 
  id="aprInput" 
  placeholder="e.g. 1,000,000" 
  inputmode="numeric" 
  style="text-align:center;" />

    <button onclick="simulateApr()">Calculate</button>
    <div id="aprResult" style="margin-top:14px; font-size:15px; color:#2ff6de;"></div>
  </div>
</div>


<!-- üîé Search bar -->
<div style="margin-bottom:12px; display:flex; gap:8px;">
  <input type="text" id="stakingSearch" placeholder="Enter wallet address (erd1...)" 
         style="flex:1; padding:8px; border-radius:6px; border:1px solid #444; background:#111827; color:#fff;">
  <button onclick="searchStaker()" style="background:#28a745; font-weight:600;">Search</button>
</div>

<!-- üî• mesaj sub search -->
<div id="stakingSearchResult" style="margin-bottom:12px; font-size:14px;"></div>

<table id="stakingTable" style="width:100%;border-collapse:collapse;margin-top:15px;background:#0c1320;border:1px solid #2ff6de33;border-radius:12px;overflow:hidden;box-shadow:0 0 8px rgba(47,246,222,0.08);">
  <thead>
    <tr style="background:linear-gradient(90deg,#042030,#07374c);color:#2ff6de;">
        <th style="padding:8px; text-align:center;">Rank</th>
        <th style="padding:8px; text-align:center;">Address</th>
        <th style="padding:8px; text-align:center;">Total TCL</th>
        <th style="padding:8px; text-align:center;">NFT</th>
        <th style="padding:8px; text-align:center;">Loan</th>
        <th style="padding:8px; text-align:center;">Infinity</th>
      </tr>
    </thead>
    <tbody id="stakingBody">
      <tr><td colspan="6" style="padding:10px;text-align:center;">‚è≥ Loading leaderboard...</td></tr>
    </tbody>
  </table>
</div>

<!-- Connect xPortal Tutorial -->
<div id="connectXportal" class="section-page"> <!-- ‚ùå fƒÉrƒÉ active -->


  <h2 data-i18n="connect_title"></h2>
  <p style="color:#a1a1aa; font-size:15px; margin-bottom:15px;" data-i18n="connect_intro"></p>

  <!-- Step 1 -->
  <div class="event-card">
    <div class="event-title" data-i18n="step1_title"></div>
    <div class="event-desc" data-i18n="step1_desc"></div>
  </div>

  <!-- Step 2 -->
  <div class="event-card">
    <div class="event-title" data-i18n="step2_title"></div>
    <div class="event-desc" data-i18n="step2_desc"></div>
  </div>

  <!-- Step 3 -->
  <div class="event-card">
    <div class="event-title" data-i18n="step3_title"></div>
    <div class="event-desc" data-i18n="step3_desc"></div>
  </div>

  <!-- Step 4 -->
  <div class="event-card">
    <div class="event-title" data-i18n="step4_title"></div>
    <div class="event-desc" data-i18n="step4_desc"></div>
  </div>

  <!-- Next Steps -->
  <div class="event-card">
    <div class="event-title" data-i18n="next_title"></div>
    <div class="event-desc" data-i18n="next_desc"></div>
  </div>

  <small style="display:block;margin-top:20px;color:#6b7280;" data-i18n="help_text"></small>
</div>

<!-- Overlay pentru zoom -->
<div id="overlay" class="overlay" onclick="closeImage()">
  <span class="close">&times;</span>
  <img id="overlayImg" class="overlay-img" />
</div>

<!-- Redeem Œ± Voucher -->
<div id="redeemAlpha" class="section-page">
  <h2 data-i18n="alpha_title"></h2>
  <p class="event-desc" data-i18n="alpha_intro"></p>

  <!-- Steps -->
  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step1_title"></div>
    <div class="event-desc" data-i18n="alpha_step1_desc"></div>
  </div>

  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step2_title"></div>
    <div class="event-desc" data-i18n="alpha_step2_desc"></div>
  </div>

  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step3_title"></div>
    <div class="event-desc" data-i18n="alpha_step3_desc"></div>
  </div>

  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step4_title"></div>
    <div class="event-desc" data-i18n="alpha_step4_desc"></div>
  </div>

  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step5_title"></div>
    <div class="event-desc" data-i18n="alpha_step5_desc"></div>
  </div>

  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step6_title"></div>
    <div class="event-desc" data-i18n="alpha_step6_desc"></div>
  </div>

  <div class="event-card">
    <div class="event-title" data-i18n="alpha_step7_title"></div>
    <div class="event-desc" data-i18n="alpha_step7_desc"></div>
  </div>

  <small style="display:block;margin-top:20px;color:#6b7280;" data-i18n="alpha_help_text"></small>
</div>

<!-- Wallet Check -->
<div id="walletCheck" class="section-page">
  <h2>üîé Wallet Check</h2>
  <p style="color:#a1a1aa; font-size:15px; margin-bottom:15px;">
    Enter your xPortal wallet address (erd1...) to see your <b>EGLD</b>, <b>TCL</b> and <b>NFTs</b>.
  </p>

  <div class="row-group">
    <div style="flex:2;">
      <label>Wallet Address</label>
      <input type="text" id="walletInput" placeholder="erd1..." />
    </div>
    <div style="flex:1; display:flex; align-items:flex-end;">
      <button style="background:#28a745;" onclick="checkWallet()">Check</button>
    </div>
  </div>

  <div class="result" id="walletResult" style="margin-top:20px;">
    ‚è≥ Waiting for input...
  </div>
</div>

<script>
function openNFTs() {
  window.location.href = "NFTs.html"; // deschide NFTs √Æn acela»ôi tab
}

function openWiki() {
  window.location.href = "wiki.html"; // deschide √Æn acela»ôi tab
}
function openTCL() {
  window.open("https://www.thecursedland.com/", "_blank");
}
function openXPortal() {
  window.open("https://xportal.com/app", "_blank");
}
function openLander() {
  window.open("https://www.thecursedland.com/lander", "_blank");
}
  let mode = 'buy';
  const DEX_API_URL = "https://api.dexscreener.io/latest/dex/pairs/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff";
  const LEADERBOARD_URL = "https://axel4ro.github.io/TCLexplorer/leaderboard.json";
  const MULTIVERSX_API = "https://api.multiversx.com";

  // ===== Utils =====
  function formatNumber(n) {
    return Number(n).toLocaleString("en-US", { maximumFractionDigits: 2 });
  }
  function parseNumber(value) {
    return parseFloat((value || '').toString().replace(/,/g, '')) || 0;
  }
  function formatInputField(input) {
    let value = input.value.replace(/,/g, '');
    if (!isNaN(value) && value !== '') input.value = formatNumber(value);
  }
  function getText(id){ return (document.getElementById(id).textContent || '').trim(); }
  function setText(id, v){ document.getElementById(id).textContent = v; }
  // helper pentru traduceri dinamice cu variabile
function t(key, vars = {}) {
  if (!translations[key]) return key; // fallback
  let str = translations[key];
  for (const [k, v] of Object.entries(vars)) {
    str = str.replace(new RegExp(`{${k}}`, "g"), v);
  }
  return str;
}


// ===== Calculator =====
function switchMode() {
  const inputLabel = document.getElementById("inputLabel");
  const switchBtn = document.getElementById("switchBtn");
  const input = document.getElementById("amount");
  mode = (mode === 'buy') ? 'sell' : 'buy';

  inputLabel.innerHTML = mode === 'buy'
    ? translations['calc_label_buy']
    : translations['calc_label_sell'];

  switchBtn.innerHTML = mode === 'buy'
    ? translations['calc_switch_to_sell']
    : translations['calc_switch_to_buy'];

  input.value = '';
  document.getElementById("resultBox").innerHTML = '';
}

function calculate() {
  // üî¢ helper pt formatare clarƒÉ cu mii »ôi zecimale
  const formatNum = (num, dec = 2) => {
    if (isNaN(num)) return "0";
    return num.toLocaleString('en-US', {
      minimumFractionDigits: dec,
      maximumFractionDigits: dec
    });
  };

  const tcl = parseNumber(getText("curTCL"));
  const usdc = parseNumber(getText("curUSDC"));
  const curPrice = parseNumber(getText("curPrice"));
  const value = parseNumber(document.getElementById("amount").value);
  const resultBox = document.getElementById("resultBox");
  resultBox.innerHTML = "";

  const feePct = 0.01;
  const valueAfterFee = value * (1 - feePct);

  if (mode === 'buy' && value > 0) {
    const newUSDC = usdc + valueAfterFee;
    const newTCL = (tcl * usdc) / newUSDC;
    const boughtTCL = tcl - newTCL;
    const avgPrice = value / boughtTCL;
    const newPrice = newUSDC / newTCL;
    const priceImpact = (avgPrice - curPrice) / avgPrice * 100;
    const pctChange = ((newPrice - curPrice) / curPrice) * 100;

    resultBox.innerHTML = t("calc_result_buy", {
      value: formatNumber(value),
      boughtTCL: formatNumber(boughtTCL),
      avgPrice: formatNum(avgPrice, 5),
      priceImpact: formatNum(priceImpact, 2),
      pctChange: formatNum(pctChange, 2),
      newPrice: formatNum(newPrice, 5),
      newTCL: formatNumber(newTCL),
      newUSDC: formatNumber(newUSDC)
    });

  } else if (mode === 'sell' && value > 0) {
    const newTCL = tcl + valueAfterFee;
    const newUSDC = (usdc * tcl) / newTCL;
    const receivedUSDC = usdc - newUSDC;
    const avgPrice = receivedUSDC / value;
    const newPrice = newUSDC / newTCL;
    const priceImpact = ((curPrice - avgPrice) / curPrice) * 100;
    const pctChange = ((newPrice - curPrice) / curPrice) * 100;

    resultBox.innerHTML = t("calc_result_sell", {
      value: formatNumber(value),
      receivedUSDC: formatNumber(receivedUSDC),
      avgPrice: formatNum(avgPrice, 5),
      priceImpact: formatNum(priceImpact, 2),
      pctChange: formatNum(pctChange, 2),
      newPrice: formatNum(newPrice, 5),
      newTCL: formatNumber(newTCL),
      newUSDC: formatNumber(newUSDC)
    });

  } else {
    resultBox.innerHTML = t("calc_error");
  }
}

// ===== Zile sƒÉptƒÉm√¢nƒÉ =====
const weekdays = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];

// Ziua curentƒÉ √Æn UTC, stil european (luni = 0, duminicƒÉ = 6)
function getTodayIndex() {
  return (new Date().getUTCDay() + 6) % 7;
}

// ===== √éncarcƒÉ events din JSON =====
const EVENTS_URL = "https://axel4ro.github.io/TCLexplorer/weekly_events.json";
let currentDay = null;
let eventsData = {};
async function loadEvents() {
  try {
    const res = await fetch(EVENTS_URL + "?t=" + Date.now());
    eventsData = await res.json();

    currentDay = weekdays[getTodayIndex()];
    console.log("‚úÖ Today:", currentDay); // debug
    renderDayButtons(currentDay);
    showEventsForDay(currentDay);

  } catch (err) {
    document.getElementById("eventContainer").innerHTML = "‚ùå Error loading events.";
    console.error("Events load error", err);
  }
}


// ===== Butoane zile =====
function renderDayButtons(activeDay) {
  const translatedDays = translations["days"] || weekdays;
  let html = "";

  weekdays.forEach((day, i) => {
    const label = translatedDays[i];
    const isActive = day === activeDay;

    html += `<button onclick="showEventsForDay('${day}')"
                style="flex:1; padding:6px; border-radius:6px; border:none; cursor:pointer; font-weight:600;
                       background:${isActive ? '#28a745' : '#007bff'}; color:white;">
                ${label}
             </button>`;
  });

  document.getElementById("eventButtons").innerHTML = html;
}
// ===== DetectƒÉm device =====
function isMobile() {
  return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
}

// ===== Afi»ôare evenimente =====
function showEventsForDay(day) {
  currentDay = day;
  renderDayButtons(day);

  const container = document.getElementById("eventContainer");
  container.innerHTML = "";
  const events = eventsData[day] || [];

  if (events.length === 0) {
    container.innerHTML = `<p>${t("events_none")}</p>`;
    return;
  }

  let now = new Date();
  let html = "";

  events.forEach(ev => {
    let [sh, sm] = ev.start.split(":").map(Number);
    let [eh, em] = ev.end.split(":").map(Number);

    let targetIndex = weekdays.indexOf(day);
    let dayOffset = (targetIndex - getTodayIndex() + 7) % 7;

    let start = new Date(Date.UTC(
      now.getUTCFullYear(),
      now.getUTCMonth(),
      now.getUTCDate() + dayOffset,
      sh, sm
    ));

    let end = new Date(Date.UTC(
      now.getUTCFullYear(),
      now.getUTCMonth(),
      now.getUTCDate() + dayOffset,
      eh, em
    ));

    if (end <= start) end.setUTCDate(end.getUTCDate() + 1);
    if (end < now) {
      start.setUTCDate(start.getUTCDate() + 7);
      end.setUTCDate(end.getUTCDate() + 7);
    }

    // ===== Status =====
    let statusText = "";
    let borderClass = "";

    if (now >= start && now <= end) {
      let diff = Math.floor((end - now) / 60000);
      let h = Math.floor(diff / 60), m = diff % 60;
      statusText = t("events_active", { h, m });
      borderClass = "event-active";

      // === Trimite notificare doar pe desktop
	if (!ev._notified) {
	  notify("üéâ Event Live!", `${ev.name} is now ACTIVE for ${h}h ${m}m`);
	  ev._notified = true;
	}
		

    } else {
      let diff = Math.floor((start - now) / 60000);
      let h = Math.floor(diff / 60), m = diff % 60;

      if (diff <= 0) {
        statusText = t("events_ended");
        borderClass = "event-expired";
      } else if (diff <= 24 * 60) {
        statusText = t("events_soon", { h, m });
        borderClass = "event-soon";
      } else {
        statusText = t("events_later", { h, m });
      }
    }

    // ===== DuratƒÉ =====
    let durMs = end - start;
    let durH = Math.floor(durMs / 3600000);
    let durM = (durMs % 3600000) / 60000;

    let evName = translations["events"]?.[ev.name]?.name || ev.name;
    let evDesc = translations["events"]?.[ev.name]?.desc || ev.description;
    let imageName = ev.image;

    html += `
      <div class="event-card ${borderClass}" style="position:relative;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <div class="event-title">${evName}</div>
            <div class="event-desc">${evDesc}</div>
            <div class="event-status">
              ${statusText} ‚Ä¢ ${t("events_duration", { duration: (durH>0 ? durH+'h ' : '')+(durM>0 ? durM+'m' : '') })}
            </div>
          </div>
          ${ imageName ? 
             `<button 
                onclick="openImage('https://axel4ro.github.io/TCLexplorer/images/${imageName}')"
                style="background:#0d6efd; color:#fff; border:none; border-radius:6px; padding:6px 10px; cursor:pointer; font-size:13px; margin-left:8px;">
                ‚ÑπÔ∏è Info
              </button>` 
             : `` }
        </div>
      </div>`;
  });

  container.innerHTML = html;
}

  // ===== Data Fetch =====
  async function fetchPoolData() {
    try {
      const res = await fetch(DEX_API_URL);
      const data = await res.json();
      const pool = data.pair;
      setText("curTCL", formatNumber(pool.liquidity.base));
	  setText("curUSDC", formatNumber(pool.liquidity.quote) + " $");
	  setText("curPrice", parseFloat(pool.priceUsd).toFixed(6) + " $");

	  const change = parseFloat(pool.priceChange.h24).toFixed(2);
      const symbol = change >= 0 ? "üìà +" : "üìâ ";
      setText("change24h", symbol + change + "%");
    } catch (err) { console.error("‚ùå Failed to fetch pool data:", err); }
  }

  async function fetchGeckoAthAtl(){
    try {
      const resp = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=lander");
      const arr = await resp.json();
      if(arr && arr.length > 0){
        const data = arr[0];
		setText("ath", data.ath.toFixed(6) + " $");
		setText("atl", data.atl.toFixed(6) + " $");

      }
    } catch(e){ console.error("‚ùå CoinGecko ATH/ATL error", e); }
  }

// ===== MultiversX Explorer Data =====
async function fetchExplorerData() {
  try {
    const res = await fetch(`${MULTIVERSX_API}/tokens/TCL-fe459d`);
    const data = await res.json();
    if (!data) return;

    const decimals = data.decimals || 18;

    // ‚úÖ Max Supply = initialMinted
    const maxSupply = parseFloat(data.initialMinted) / (10 ** decimals);

    // ‚úÖ Burned & Circulating
    const burned = parseFloat(data.burnt) / (10 ** decimals);
    const circulating = parseFloat(data.circulatingSupply) || (maxSupply - burned);
    const currentSupply = parseFloat(data.supply) || 0;
    const marketCap = data.marketCap || 0;
    const holders = data.accounts || 0;
    const transactions = data.transfers || 0;
	const volume24h = data.totalVolume24h || 0;
    const tradesCount = data.tradesCount || 0;

// ‚úÖ Scriem valorile cu $ la final
setText("marketCap", formatNumber(marketCap) + " $");
setText("holders", holders.toLocaleString());
setText("transactions", transactions.toLocaleString());
setText("circulating", formatNumber(circulating));
setText("burned", formatNumber(burned));
setText("supply", formatNumber(maxSupply));
setText("currentSupply", formatNumber(currentSupply));
setText("volume24h", formatNumber(volume24h) + " $");
setText("tradesCount", tradesCount.toLocaleString());

	
  } catch (err) {
    console.error("‚ùå Explorer fetch error", err);
  }
}

  // ===== Staking Leaderboard din JSON =====
function formatTcl(val, decimals = 18) {
  if (!val) return "0";

  // transformƒÉm valoarea √Æntr-un string "normal" (fƒÉrƒÉ e+xx)
  let strVal = typeof val === "number"
  ? val.toLocaleString("fullwide", { useGrouping: false })
  : val.toString(); // ‚úÖ merge »ôi cu string


  // acum folosim BigInt
  let num = BigInt(strVal);
  let divisor = BigInt(10) ** BigInt(decimals);

  let whole = num / divisor;

  return whole.toLocaleString("en-US");
}

async function fetchLeaderboard() {
  const body = document.getElementById("stakingBody");
  const statusEl = document.getElementById("lastUpdated");

  if (!body) return;

  body.innerHTML = '<tr><td colspan="6" style="padding:10px;text-align:center;">‚è≥ Leaderboard is being updated on-chain...</td></tr>';
  statusEl.textContent = "‚è≥ Fetching latest staking data...";

  try {
    const resp = await fetch(LEADERBOARD_URL + "?t=" + Date.now());
    if (!resp.ok) {
      statusEl.textContent = "‚ùå Failed to load leaderboard";
      return;
    }

const data = await resp.json();

if (!data || Object.keys(data).length === 0) {
  body.innerHTML = '<tr><td colspan="6" style="padding:10px;text-align:center;">‚ö†Ô∏è No data available (update in progress)</td></tr>';
  statusEl.textContent = "‚ö†Ô∏è Leaderboard update still in progress...";
  return;
}

// ‚úÖ acum lucrƒÉm direct cu data
lastUpdateTime = new Date();

const results = Object.entries(data).map(([addr, v]) => ({
  addr,
  rank: v.rank,
  nft: v.nft,
  loan: v.loan,
  infinity: v.infinity,
  total: v.total
}));

// sortƒÉm dupƒÉ rank
results.sort((a, b) => a.rank - b.rank);

// ‚úÖ filtrƒÉm cei cu 0 peste tot
const filtered = results.filter(r =>
  Number(r.total) > 0 ||
  Number(r.nft) > 0 ||
  Number(r.loan) > 0 ||
  Number(r.infinity) > 0
);

// ‚úÖ pƒÉstrƒÉm doar primii 100
const top100 = filtered.slice(0, 100);

let html = "";
top100.forEach(r => {
  // scurtƒÉm afi»ôarea adresei
  let shortAddr = r.addr.slice(0, 6) + "..." + r.addr.slice(-4);

  html += "<tr>" +
    "<td style='padding:6px;text-align:center;'>" + r.rank + "</td>" +
    "<td style='padding:6px; display:flex; align-items:center; gap:6px;'>" +
      "<span style='font-family:monospace;'>" + shortAddr + "</span>" +
      "<button onclick=\"copyAddr('" + r.addr + "', event)\" " +
        "style='padding:2px 6px; font-size:12px; border:none; border-radius:4px; cursor:pointer; background:#28a745; color:white;'>Copy</button>" +
    "</td>" +
    "<td style='padding:6px;font-weight:bold;'>" + formatTcl(r.total) + "</td>" +
    "<td style='padding:6px;'>" + formatTcl(r.nft) + "</td>" +
    "<td style='padding:6px;'>" + formatTcl(r.loan) + "</td>" +
    "<td style='padding:6px;'>" + formatTcl(r.infinity) + "</td>" +
  "</tr>";
});

body.innerHTML = html;

	  
  } catch (err) {
    console.error("Leaderboard error", err);
    statusEl.textContent = "‚ùå Error loading leaderboard";
    body.innerHTML =
      '<tr><td colspan="6" style="padding:10px;text-align:center;">‚ö†Ô∏è Error loading leaderboard</td></tr>';
  }
}

  function updateStakingLeaderboard() {
    fetchLeaderboard();
  }
	
async function searchStaker() {
  const input = document.getElementById("stakingSearch").value.trim();
  const searchResult = document.getElementById("stakingSearchResult");
  const tableBody = document.getElementById("stakingBody");

  // curƒÉ»õƒÉm highlight-ul anterior
  document.querySelectorAll("#stakingBody tr").forEach(tr => tr.classList.remove("highlight-row"));

  if (!input.startsWith("erd1") || input.length < 62) {
    searchResult.innerHTML = "‚ö†Ô∏è Please enter a valid wallet address (erd1...)";
    searchResult.style.color = "#f87171";
    return;
  }

  searchResult.innerHTML = "‚è≥ Searching...";
  searchResult.style.color = "#eab308";

  try {
    const resp = await fetch(LEADERBOARD_URL + "?t=" + Date.now());
    const data = await resp.json();

    const leaderboardArray = Object.entries(data).map(([addr, v]) => ({
      addr,
      rank: v.rank,
      total: BigInt(v.total || 0),
      infinity: BigInt(v.infinity || 0),
      loan: BigInt(v.loan || 0),
      nft: BigInt(v.nft || 0)
    }));

    leaderboardArray.sort((a, b) => Number(a.rank) - Number(b.rank));
    const top100 = leaderboardArray.slice(0, 100);
    const lastTop = top100[top100.length - 1];

    const staker = data[input];

    if (staker) {
      if (staker.rank <= 100) {
        // ‚úÖ Found in Top 100
        searchResult.innerHTML = `
          ‚úÖ Found in Top 100!<br>
          üèÜ Rank: #${staker.rank}<br>
          üí† Total: ${formatTcl(staker.total)}<br>
          üîπ Infinity: ${formatTcl(staker.infinity)}<br>
          üîπ Loan: ${formatTcl(staker.loan)}<br>
          üîπ NFT Stake: ${formatTcl(staker.nft)}
        `;
        searchResult.style.color = "#10b981";

        // highlight row + scroll
        const rows = Array.from(tableBody.querySelectorAll("tr"));
        const foundRow = rows.find(r => r.cells[0]?.textContent.trim() === String(staker.rank));
        if (foundRow) {
          foundRow.classList.add("highlight-row");
          foundRow.scrollIntoView({ behavior: "smooth", block: "center" });
          setTimeout(() => foundRow.classList.remove("highlight-row"), 4000);
        }
      } else {
        // üòî Are staking dar sub top 100
        const diff = (lastTop.total + 1n) - BigInt(staker.total || 0n);
        searchResult.innerHTML = `
          ‚ö†Ô∏è Not in Top 100.<br>
          ü™ô You currently have <b>${formatTcl(staker.total)}</b> TCL staked.<br>
          üîù To enter the leaderboard, you need at least <b>${formatTcl(lastTop.total + 1n)}</b> TCL total.<br>
          ‚ûï So you need <b style="color:#facc15;">${formatTcl(diff)}</b> more TCL to reach rank #100! üî•
        `;
        searchResult.style.color = "#facc15";
      }
    } else {
      // ‚ùå wallet deloc √Æn leaderboard
      const needToEnter = lastTop.total + 1n;
      searchResult.innerHTML = `
        ‚ö†Ô∏è Address not found in leaderboard.<br>
        ü™ô To enter the Top 100, you need at least <b>${formatTcl(needToEnter)}</b> TCL staked. üî•
      `;
      searchResult.style.color = "#f87171";
    }

  } catch (err) {
    console.error("Leaderboard fetch error", err);
    searchResult.innerHTML = "‚ö†Ô∏è Error fetching leaderboard.";
    searchResult.style.color = "#f87171";
  }
}


// ===== Navigation =====
const XEXCHANGE_URL = "https://xexchange.com/trade?firstToken=USDC-c76f1f&secondToken=TCL-fe459d";
const menuButtons = document.querySelector(".menu-buttons"); // üî• adƒÉugat

function isMobile() {
  return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
}

// üëâ Meniul se √Ænchide doar dupƒÉ ce selecteazƒÉ o paginƒÉ
function showPage(id) {
  // ascundem toate paginile
  document.querySelectorAll('.section-page').forEach(sec => {
    sec.classList.remove('active', 'fullpage');
  });

  // activƒÉm pagina selectatƒÉ
  const page = document.getElementById(id);
  if (page) {
    page.classList.add('active');
    if (id === 'chart' || id === 'explorerIframe' || id === 'xexchangeIframe') {
      page.classList.add('fullpage');
    }
  }
  // zoom diferit √Æn func»õie de paginƒÉ
  const viewport = document.querySelector("meta[name=viewport]");
  if (id === "staking") {
    document.body.style.zoom = "0.75";
    viewport.setAttribute("content","width=device-width, initial-scale=0.75, minimum-scale=0.5, maximum-scale=1.0, user-scalable=yes");
  } else if (id === "walletCheck") {
    document.body.style.zoom = "1.0";
    viewport.setAttribute("content","width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes");
  } else {
    document.body.style.zoom = "1.0";
    viewport.setAttribute("content","width=device-width, initial-scale=0.85, minimum-scale=0.5, maximum-scale=1.0, user-scalable=yes");
  }
  // üî• dupƒÉ primul click, meniu poate fi √Ænchis normal
  firstLoad = false;
  // üî• √énchidem meniul dupƒÉ selectare
  const panel = document.getElementById("menuPanel");
  const btn = document.getElementById("menuToggle");
  panel.classList.remove("open");
  btn.textContent = "‚ò∞ Menu";
  
  // reaplicƒÉ traducerile c√¢nd se schimbƒÉ pagina
  applyTranslations();
}

  // ===== On Load =====
window.onload = function() {
  fetchPoolData();
  fetchGeckoAthAtl();
  updateStakingLeaderboard();
  loadEvents(); // ‚úÖ √ÆncarcƒÉ »ôi events

  setInterval(function() {
    fetchPoolData();
    fetchGeckoAthAtl();
    const hasValue = parseNumber(document.getElementById('amount').value) > 0;
    if (hasValue) calculate();
  }, 300000);
  
fetchLeaderboardLastUpdate(); // ia commitul ini»õial
setInterval(fetchLeaderboardLastUpdate, 2 * 60 * 1000); // verificƒÉ commit nou la 2 min
setInterval(updateCommitRelative, 1000); // actualizeazƒÉ ‚Äûx seconds/minutes ago‚Äù la fiecare secundƒÉ


};
// Auto-refresh events countdown every minute
setInterval(() => {
  if (currentDay) {
    showEventsForDay(currentDay);
  }
}, 60000); // 60000ms = 1 minut

fetchExplorerData();
setInterval(fetchExplorerData, 300000); // la fiecare 5 min


// === TCL Sentiment Index ===
const gauge = document.getElementById("sentimentGauge");
const gctx = gauge.getContext("2d");

function drawSentimentGauge(score) {
  const start = Math.PI, end = 2 * Math.PI;
  const mid = start + (end - start) * (score / 100);
  gctx.clearRect(0, 0, gauge.width, gauge.height);

  const bg = gctx.createLinearGradient(0, 0, gauge.width, 0);
  bg.addColorStop(0, "#ef4444");
  bg.addColorStop(0.5, "#facc15");
  bg.addColorStop(1, "#22c55e");

  gctx.lineWidth = 18;
  gctx.lineCap = "round";
  gctx.strokeStyle = "#1f2937";
  gctx.beginPath();
  gctx.arc(gauge.width / 2, gauge.height, 70, start, end);
  gctx.stroke();

  gctx.strokeStyle = bg;
  gctx.beginPath();
  gctx.arc(gauge.width / 2, gauge.height, 70, start, mid);
  gctx.stroke();
}

function sentimentLabel(score) {
  // Fallback dacƒÉ translations nu este definit
  if (!translations || !translations['sentiment_labels']) {
    if (score <= 24) return { text: "üò± Strong Opportunity ‚Äî Bottom Levels", color: "#ef4444" };
    if (score <= 44) return { text: "üòü Accumulation Zone ‚Äî Still Undervalued", color: "#f97316" };
    if (score <= 55) return { text: "üòê Stabilizing ‚Äî Good Entry Range", color: "#facc15" };
    if (score <= 74) return { text: "üòÑ Watch Closely ‚Äî Momentum Building", color: "#84cc16" };
    return { text: "üöÄ Bullish Sentiment ‚Äî Growth Phase Starting", color: "#22c55e" };
  }

  // Folose»ôte traducerile dacƒÉ sunt disponibile
  if (score <= 24) return { 
    text: translations['sentiment_labels']['very_low'], 
    color: "#ef4444" 
  };
  if (score <= 44) return { 
    text: translations['sentiment_labels']['low'], 
    color: "#f97316" 
  };
  if (score <= 55) return { 
    text: translations['sentiment_labels']['neutral'], 
    color: "#facc15" 
  };
  if (score <= 74) return { 
    text: translations['sentiment_labels']['high'], 
    color: "#84cc16" 
  };
  return { 
    text: translations['sentiment_labels']['very_high'], 
    color: "#22c55e" 
  };
}

// === TCL Sentiment Index - VERSIUNE CORECTATƒÇ ===
async function updateSentimentIndex() {
  try {
    // üîπ Fetch toate datele necesare
    const [dexRes, mvxRes] = await Promise.all([
      fetch("https://api.dexscreener.io/latest/dex/pairs/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff").then(r => r.json()),
      fetch("https://api.multiversx.com/tokens/TCL-fe459d").then(r => r.json())
    ]);

    const pair = dexRes.pair;
    const priceChange = parseFloat(pair.priceChange?.h24) || 0;
    const liquidity = pair.liquidity?.usd || 0;
    const volume = pair.volume?.h24 || 0;
    
    // üîπ Date din MultiversX API
    const holders = mvxRes.accounts || 0;
    const txs = mvxRes.transfers || 0;
    const circulating = mvxRes.circulatingSupply || 1;
    const marketCap = mvxRes.marketCap || 0;
    
    // üîπ Calcul burned
    const burned = mvxRes.burnt ? parseFloat(mvxRes.burnt) / 1e18 : 0;
    const supply = mvxRes.initialMinted ? parseFloat(mvxRes.initialMinted) / 1e18 : 1;
    const burnedPct = (burned / supply) * 100;

    // üîπ Staking data simplificatƒÉ
    let stakedPct = 0;
    try {
      const hexAddr = bech32ToHex("erd1qqqqqqqqqqqqqpgqm77vv5dcqs6kuzhj540vf67f90xemypd0ufsygvnvk");
      const stRes = await fetch("https://api.multiversx.com/query", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          scAddress: "erd1qqqqqqqqqqqqqpgqm77vv5dcqs6kuzhj540vf67f90xemypd0ufsygvnvk",
          funcName: "getRewardsData",
          args: [hexAddr]
        })
      });
      const stData = await stRes.json();
      if (stData.returnData && stData.returnData[0]) {
        const decoded = atob(stData.returnData[0]);
        const parts = decoded.split(" ");
        const staked = parseFloat(parts[3]) / 1e18;
        stakedPct = (staked / circulating) * 100;
      }
    } catch (e) {
      console.warn("Staking data error:", e);
    }

    // üîπ Locked data simplificatƒÉ
    let lockedPct = 0;
    try {
      const lockedRes = await fetch("https://api.multiversx.com/tokens/TCL-fe459d/locked-accounts");
      const lockedData = await lockedRes.json();
      if (Array.isArray(lockedData)) {
        lockedPct = lockedData.reduce((acc, item) => acc + (item.percentage || 0), 0);
      }
    } catch (e) {
      console.warn("Locked data error:", e);
    }

    // üîπ Calcul scor final
    let score = 0; // start de la 50 (neutral)

    // AdƒÉugƒÉm/scƒÉdem √Æn func»õie de factori
    score += Math.max(Math.min(priceChange, 10), -10) * 1.2; // ¬±12 din pre»õ
    score += Math.min(volume / 100, 5);                    // volum
    score += Math.min(liquidity / 10000, 8);                 // lichiditate
    score += Math.min(holders / 1000, 6);                     // holderi
    score += Math.min(txs / 300000, 8);                      // tranzac»õii
    score += Math.min(stakedPct / 1, 12);                    // staking
    score += Math.min(burnedPct / 1, 8);                     // burned
    score += Math.min(lockedPct / 2, 10);                    // locked
    
    // AjustƒÉri pentru market cap
    if (marketCap < 500000) score -= 5;
    else if (marketCap > 1000000) score += 5;

    score = Math.max(0, Math.min(100, Math.round(score)));

    // üîπ Actualizare interfa»õƒÉ
    const { text, color } = sentimentLabel(score);
    drawSentimentGauge(score);

    const scoreEl = document.getElementById("sentimentScore");
    scoreEl.textContent = score;
    scoreEl.style.transform = "scale(1.08)";
    setTimeout(() => (scoreEl.style.transform = "scale(1)"), 300);

    const label = document.getElementById("sentimentLabel");
    label.textContent = text;
    label.style.color = color;

    console.log("‚úÖ Sentiment updated:", score, text);

  } catch (e) {
    console.error("‚ùå Sentiment error:", e);
    // Fallback √Æn caz de eroare
    document.getElementById("sentimentScore").textContent = "?";
    document.getElementById("sentimentLabel").textContent = "Data unavailable";
    document.getElementById("sentimentLabel").style.color = "#6b7280";
  }
}

// === Ini»õializare la √ÆncƒÉrcare ===
document.addEventListener("DOMContentLoaded", function() {
  // A»ôteaptƒÉ pu»õin pentru a se √ÆncƒÉrca restul datelor
  setTimeout(updateSentimentIndex, 2000);
  
  // ActualizeazƒÉ la fiecare 5 minute
  setInterval(updateSentimentIndex, 5 * 60 * 1000);
});


// === Deschidem meniul imediat la primul load ===
document.addEventListener("DOMContentLoaded", () => {
  const panel = document.getElementById("menuPanel");
  const menuBtn = document.getElementById("menuToggle");
  const langBtn = document.getElementById("currentLang");
  const langMenu = document.querySelector(".lang-menu");

  if (panel && menuBtn) {
    panel.classList.add("open");
    menuBtn.textContent = "‚ò∞ Menu";

    // ascundem toate paginile la start
    document.querySelectorAll('.section-page').forEach(sec => {
      sec.classList.remove('active', 'fullpage');
    });
  }

  // === Click pe Language (independent de meniul principal)
  if (langBtn && langMenu) {
    langBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();

      // toggle doar dropdown-ul de limbƒÉ
      const isOpen = langMenu.style.display === "block";
      document.querySelectorAll(".lang-menu").forEach(m => m.style.display = "none");
      langMenu.style.display = isOpen ? "none" : "block";
    });

    // üî• click √Æn afara dropdownului -> √Æl √Ænchide
    document.addEventListener("click", (e) => {
      if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
        langMenu.style.display = "none";
      }
    });
  }
});


// üî• Toggle pentru meniul de naviga»õie
document.getElementById("menuToggle").addEventListener("click", () => {
  const panel = document.getElementById("menuPanel");
  const btn = document.getElementById("menuToggle");

  // üëâ dacƒÉ e prima √ÆncƒÉrcare »ôi userul n-a selectat o paginƒÉ, ignorƒÉm click
  if (firstLoad && panel.classList.contains("open")) return;

  panel.classList.toggle("open");
  btn.textContent = panel.classList.contains("open") ? "‚úñ Close" : "‚ò∞ Menu";
});

function openImage(src) {
  const overlay = document.getElementById("overlay");
  const overlayImg = document.getElementById("overlayImg");

  if (overlay && overlayImg) {
    overlay.style.display = "flex"; // facem overlay-ul vizibil
    overlayImg.src = src;           // setƒÉm imaginea
    overlayImg.style.transform = "scale(1)"; // reset zoom
    scale = 1; // resetƒÉm zoom-ul global
  }
}


function closeImage() {
  document.getElementById("overlay").style.display = "none";
}

// Zoom cu scroll (desktop)
const overlayImg = document.getElementById("overlayImg");
let scale = 1;
overlayImg?.addEventListener("wheel", e => {
  e.preventDefault();
  if (e.deltaY < 0) {
    scale += 0.1;
  } else {
    scale = Math.max(1, scale - 0.1);
  }
  overlayImg.style.transform = `scale(${scale})`;
});

const BASE_URL = "https://axel4ro.github.io/TCLexplorer/lang/";
let translations = {};
let currentLang = localStorage.getItem("lang") || "en";

// Dropdown custom
const langDropdown = document.querySelector('.lang-dropdown');
const currentLangBtn = document.getElementById('currentLang');

// üîπ Limbile suportate
const LANGS = [
  { code: "en", label: "English", flag: "gb" },
  { code: "ro", label: "Rom√¢nƒÉ", flag: "ro" },
  { code: "tr", label: "T√ºrk√ße", flag: "tr" },
  { code: "de", label: "Deutsch", flag: "de" },
  { code: "es", label: "Espa√±ol", flag: "es" },
  { code: "fr", label: "Fran√ßais", flag: "fr" },
  { code: "it", label: "Italiano", flag: "it" },
  { code: "pl", label: "Polski", flag: "pl" },
  { code: "pt", label: "Portugu√™s", flag: "pt" }
];

// üîπ VerificƒÉ dacƒÉ fi»ôierul JSON existƒÉ pe server
async function checkLangFile(lang) {
  try {
    const res = await fetch(`${BASE_URL}${lang}.json`, { method: "HEAD" });
    return res.ok;
  } catch {
    return false;
  }
}
async function buildLangDropdown() {
  const menu = document.querySelector(".lang-menu");
  menu.innerHTML = ""; // curƒÉ»õƒÉm complet

  for (const lang of LANGS) {
    if (await checkLangFile(lang.code)) {
      const option = document.createElement("div");
      option.className = "lang-option";
      option.innerHTML = `<img src="https://flagcdn.com/w20/${lang.flag}.png"> ${lang.label}`;
      option.onclick = () => setLang(lang.code);
      menu.appendChild(option);
    }
  }
}


async function loadTranslations(lang) {
  try {
    const res = await fetch(`${BASE_URL}${lang}.json?t=${Date.now()}`);
    translations = await res.json();
    currentLang = lang;
    localStorage.setItem("lang", lang);
    
    // üîπ AplicƒÉ traducerile imediat
    applyTranslations();
    
    // üîπ RecalculeazƒÉ sentiment index dupƒÉ ce traducerile sunt √ÆncƒÉrcate
    updateSentimentIndex();

    // üî• actualizeazƒÉ vizual dropdown-ul cu steag + text
    let label = "English", flag = "https://flagcdn.com/w20/gb.png";
    if (lang === "ro") { label = "Rom√¢nƒÉ"; flag = "https://flagcdn.com/w20/ro.png"; }
    if (lang === "tr") { label = "T√ºrk√ße"; flag = "https://flagcdn.com/w20/tr.png"; }
    if (lang === "de") { label = "Deutsch"; flag = "https://flagcdn.com/w20/de.png"; }
    if (lang === "es") { label = "Espa√±ol"; flag = "https://flagcdn.com/w20/es.png"; }
    if (lang === "fr") { label = "Fran√ßais"; flag = "https://flagcdn.com/w20/fr.png"; }
    if (lang === "it") { label = "Italiano"; flag = "https://flagcdn.com/w20/it.png"; }
    if (lang === "pl") { label = "Polski"; flag = "https://flagcdn.com/w20/pl.png"; }
    if (lang === "pt") { label = "Portugu√™s"; flag = "https://flagcdn.com/w20/pt.png"; }
    currentLangBtn.innerHTML = `<img src="${flag}" alt="${lang.toUpperCase()}"> ${label}`;

  } catch (err) {
    console.error("‚ùå Translation load error:", err);
  }
}

function applyTranslations() {
  const activePage = document.querySelector(".section-page.active");
  const hasTranslations = activePage && activePage.querySelectorAll("[data-i18n]").length > 0;
 // üåç butonul Language apare mereu, dar dacƒÉ nu sunt traduceri -> doar EN rƒÉm√¢ne
document.querySelector(".lang-dropdown").style.display = "block";


  if (!translations || Object.keys(translations).length === 0) return;

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (translations[key]) el.innerHTML = translations[key];
  });

  // ‚úÖ dacƒÉ avem deja rezultate, le regenerƒÉm
  if (document.getElementById("resultBox").innerHTML.trim() !== "") {
    calculate();
  }

  // üî• for»õƒÉm refresh pentru evenimente (sƒÉ nu rƒÉm√¢nƒÉ pe Loading...)
  if (currentDay) {
    showEventsForDay(currentDay);
  }
}


function setLang(lang) {
  const menu = document.querySelector(".lang-menu");
  if (menu) menu.style.display = "none"; // üî• √Ænchidem manual dropdownul
  langDropdown.classList.remove('open');
  loadTranslations(lang);
}



// DetecteazƒÉ limba device-ului »ôi seteazƒÉ-o automat la primul load
window.addEventListener("DOMContentLoaded", async () => {
  await buildLangDropdown(); // üåç construim doar limbile disponibile
  const hash = window.location.hash.replace("#", "");
  if (hash) showPage(hash);

  // dacƒÉ nu existƒÉ deja limba salvatƒÉ √Æn localStorage
  if (!localStorage.getItem("lang")) {
    let browserLang = navigator.language || navigator.userLanguage; 
    browserLang = browserLang.toLowerCase();

    if (browserLang.startsWith("ro")) {
      currentLang = "ro";
    } else if (browserLang.startsWith("tr")) {
      currentLang = "tr";
	} else if (browserLang.startsWith("de")) {
      currentLang = "de";
	} else if (browserLang.startsWith("es")) {
      currentLang = "es";
	} else if (browserLang.startsWith("fr")) {
      currentLang = "fr";
	} else if (browserLang.startsWith("it")) {
      currentLang = "it";
	} else if (browserLang.startsWith("pl")) {
      currentLang = "pl";
	} else if (browserLang.startsWith("pt")) {
      currentLang = "pt";
    } else {
      currentLang = "en"; // fallback default
    }

    localStorage.setItem("lang", currentLang);
  } else {
    currentLang = localStorage.getItem("lang");
  }

  // √ÆncarcƒÉ traducerile pentru limba detectatƒÉ sau salvatƒÉ
  loadTranslations(currentLang);
});

function copyAddr(addr, event) {
  navigator.clipboard.writeText(addr).then(() => {
    const btn = event.target;
    const oldText = btn.textContent;
    btn.textContent = "‚úÖ Copied!";
    btn.style.background = "#10b981";

    setTimeout(() => {
      btn.textContent = oldText;
      btn.style.background = "#28a745";
    }, 2000);
  });
}

async function checkWallet() {
  const address = document.getElementById("walletInput").value.trim();
  const resultBox = document.getElementById("walletResult");

  if (!address.startsWith("erd1") || address.length < 62) {
    resultBox.innerHTML = "‚ùå Invalid address. It should start with <code>erd1...</code>";
    return;
  }

  resultBox.innerHTML = "‚è≥ Fetching wallet data...";

  try {
    // === EGLD ===
    const egldRes = await fetch(`https://api.multiversx.com/accounts/${address}`);
    const egldData = await egldRes.json();
    const egld = parseFloat(egldData.balance || 0) / 1e18;

    // === TCL ===
    const TCL_IDENTIFIER = "TCL-fe459d";
    const tclRes = await fetch(`https://api.multiversx.com/accounts/${address}/tokens/${TCL_IDENTIFIER}`);
    const tclData = await tclRes.json();
    const tcl = tclData.balance ? parseFloat(tclData.balance) / 1e18 : 0;

    // === NFTs ===
    const nftRes = await fetch(`https://api.multiversx.com/accounts/${address}/nfts?size=1000`);
    const nftData = await nftRes.json();
    const walletNfts = nftData.filter(n => n.collection.startsWith("TCL"));

    // === Prices ===
    const egldPriceRes = await fetch("https://api.dexscreener.io/latest/dex/pairs/multiversx/erd1qqqqqqqqqqqqqpgqeel2kumf0r8ffyhth7pqdujjat9nx0862jpsg2pqaq");
    const egldPriceData = await egldPriceRes.json();
    const priceEGLD = parseFloat(egldPriceData.pair.priceUsd || 0);

    const tclPriceRes = await fetch("https://api.dexscreener.io/latest/dex/pairs/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff");
    const tclPriceData = await tclPriceRes.json();
    const priceTCL = parseFloat(tclPriceData.pairs?.[0]?.priceUsd || 0);

    // === Values ===
    const valueEGLD = egld * priceEGLD;
    const valueTCL = tcl * priceTCL;
	
    // === Leaderboard Data (Rank + Staking details) ===
    let stakingInfo = null;
    try {
      const lbRes = await fetch(LEADERBOARD_URL + "?t=" + Date.now());
      const lbData = await lbRes.json();
      if (lbData[address]) {
        stakingInfo = lbData[address]; 
      }
    } catch (e) {
      console.warn("‚ö†Ô∏è Leaderboard fetch failed", e);
    }
// === OUTPUT  ===
if (stakingInfo) {
  // leaderboard array pentru top 100
  const resp = await fetch(LEADERBOARD_URL + "?t=" + Date.now());
  const data = await resp.json();
  const leaderboardArray = Object.entries(data).map(([addr, v]) => v);
  leaderboardArray.sort((a, b) => a.rank - b.rank);
  const top100 = leaderboardArray.slice(0, 100);

  if (stakingInfo.rank <= 100) {
    // ‚úÖ cazul √Æn Top 100
    resultBox.innerHTML = `
      Wallet Address: <span style="font-family:monospace;">${address}</span>

      üíé EGLD: ${egld.toFixed(4)} (~$${valueEGLD.toFixed(2)})
      ü™ô TCL: ${tcl.toFixed(2)} (~$${valueTCL.toFixed(2)})

      üèÜ TCL Staking Rank: #${stakingInfo.rank}
         ‚Ä¢ Total: ${formatTcl(stakingInfo.total)}
         ‚Ä¢ Infinity: ${formatTcl(stakingInfo.infinity)}
         ‚Ä¢ Loan: ${formatTcl(stakingInfo.loan)}
         ‚Ä¢ NFT Stake: ${formatTcl(stakingInfo.nft)}

      üñºÔ∏è Owned NFTs: ${walletNfts.length}
      ${walletNfts.length > 0 
        ? walletNfts.map(n => 
            `‚Ä¢ ${n.name || "Unnamed NFT"}\n   (Collection: ${n.collection}, ID: ${n.identifier}${parseInt(n.balance) > 1 ? ` x${n.balance}` : ""})`
          ).join("\n")
        : `- None`
      }
    `;
  } else {
    // ‚ùå cazul peste locul 100
    const lastTop = top100[top100.length - 1]; // #100
    const needMore = BigInt(lastTop.total) - BigInt(stakingInfo.total);

    resultBox.innerHTML = `
      Wallet Address: <span style="font-family:monospace;">${address}</span>

      üíé EGLD: ${egld.toFixed(4)} (~$${valueEGLD.toFixed(2)})
      ü™ô TCL: ${tcl.toFixed(2)} (~$${valueTCL.toFixed(2)})

      ‚ö†Ô∏è You need <b>${formatTcl(needMore)}</b> more TCL staked 
      to overtake Rank #100 and enter the leaderboard! üî•

      üñºÔ∏è Owned NFTs: ${walletNfts.length}
      ${walletNfts.length > 0 
        ? walletNfts.map(n => 
            `‚Ä¢ ${n.name || "Unnamed NFT"}\n   (Collection: ${n.collection}, ID: ${n.identifier}${parseInt(n.balance) > 1 ? ` x${n.balance}` : ""})`
          ).join("\n")
        : `- None`
      }
    `;
  }
} else {
  // ‚ùå fƒÉrƒÉ staking deloc
  resultBox.innerHTML = `
    Wallet Address: <span style="font-family:monospace;">${address}</span>

    üíé EGLD: ${egld.toFixed(4)} (~$${valueEGLD.toFixed(2)})
    ü™ô TCL: ${tcl.toFixed(2)} (~$${valueTCL.toFixed(2)})

    üèÜ Not ranked in staking leaderboard

    üñºÔ∏è Owned NFTs: ${walletNfts.length}
    ${walletNfts.length > 0 
      ? walletNfts.map(n => 
          `‚Ä¢ ${n.name || "Unnamed NFT"}\n   (Collection: ${n.collection}, ID: ${n.identifier}${parseInt(n.balance) > 1 ? ` x${n.balance}` : ""})`
        ).join("\n")
      : `- None`
    }
  `;
}
} catch (err) {
  console.error("Wallet check error", err);
  resultBox.innerHTML = "‚ö†Ô∏è Failed to fetch wallet data.";
}
} // ‚Üê √Ænchide func»õia checkWallet


let commitDateGlobal = null;

async function fetchLeaderboardLastUpdate() {
  const statusEl = document.getElementById("lastUpdated");
  try {
    const resp = await fetch("https://api.github.com/repos/axel4ro/TCLexplorer/commits?path=leaderboard.json&page=1&per_page=1");
    const data = await resp.json();
    if (data && data.length > 0) {
      commitDateGlobal = new Date(data[0].commit.committer.date);
      updateCommitRelative(); // afi»ôƒÉm imediat
    } else {
      statusEl.textContent = "‚ö†Ô∏è No commit history found.";
    }
  } catch (err) {
    console.error("‚ùå Failed to fetch commit time:", err);
    statusEl.textContent = "‚ö†Ô∏è Failed to fetch last update time.";
  }
}

function updateCommitRelative() {
  if (!commitDateGlobal) return;
  const statusEl = document.getElementById("lastUpdated");
  const now = new Date();
  const diffMs = now - commitDateGlobal;
  const diffMins = Math.floor(diffMs / 60000);
  const diffSecs = Math.floor((diffMs % 60000) / 1000);

  let relative = "";
  if (diffMins > 0) {
    relative = diffMins + " minute" + (diffMins > 1 ? "s" : "") + " ago";
  } else if (diffSecs < 10) {
    relative = "just now";
  } else {
    relative = diffSecs + " seconds ago";
  }

  statusEl.textContent = `‚úÖ Last update on-chain: ${commitDateGlobal.toLocaleString()} (${relative})`;
}
// === NOTIFICƒÇRI DESKTOP ===
function notify(title, message) {
  if (!("Notification" in window)) {
    console.log("‚ùå Notifications not supported by this browser.");
    return;
  }

  try {
    if (Notification.permission === "granted") {
      new Notification(title, { body: message, icon: "images/tcl_icon.png" });
    } else if (Notification.permission !== "denied") {
      Notification.requestPermission().then(permission => {
        if (permission === "granted") {
          new Notification(title, { body: message, icon: "images/tcl_icon.png" });
        }
      });
    }
  } catch (err) {
    console.error("‚ùå Notification error:", err);
  }
}


if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/TCLexplorer/sw.js")
    .then(reg => console.log("‚úÖ SW registered", reg))
    .catch(err => console.error("‚ùå SW error", err));
}

// üîî Ceri permisiune notificƒÉri
async function askPermission() {
  const result = await Notification.requestPermission();
  if (result === "granted") {
    console.log("‚úÖ Notifications allowed");
  }
}
askPermission();


/* === INSTALL GUIDE Chrome-like === */
let deferredPrompt = null;

// üì≤ Android (Chrome PWA)
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;

  if (/android/i.test(navigator.userAgent)) {
    showInstallButton("android");
  }
});

// üñ•Ô∏è iOS & Windows fallback
window.addEventListener("DOMContentLoaded", () => {
  const ua = navigator.userAgent.toLowerCase();

  if (/iphone|ipad|ipod/.test(ua)) {
    showInstallButton("ios");
  } else if (/win/.test(ua)) {
    showInstallButton("windows");
  }
});

function showInstallButton(type) {
  const container = document.getElementById("installGuideContainer");
  if (!container) return;

  let btnHtml = "";
  if (type === "android") {
    btnHtml = `<button class="install-btn" onclick="installPWA()">üì≤ Install</button>`;
  } else if (type === "ios") {
    btnHtml = `<button class="install-btn" onclick="showGuide('ios')">üì≤ Add</button>`;
  } else if (type === "windows") {
    btnHtml = `<a href="https://axel4ro.github.io/TCLexplorer/TCLexplorerSetup.exe" target="_blank" class="install-btn">üíª Download</a>`;
  }
  container.innerHTML = btnHtml;
}

async function installPWA() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    console.log("User choice:", choice.outcome);
    deferredPrompt = null;
  } else {
    alert("üëâ Open the browser menu and select 'Add to Home Screen'.");
  }
}

function showGuide(type) {
  if (type === "ios") {
    const existing = document.getElementById("iosGuideBox");
    const panel = document.getElementById("menuPanel");
    const btn = document.getElementById("menuToggle");

    if (existing) {
      // üî• dacƒÉ existƒÉ deja -> √Æl eliminƒÉm »ôi redeschidem meniul
      existing.remove();
      panel.classList.add("open");
      btn.textContent = "‚úñ Close";
      return;
    }

    // üî• dacƒÉ nu existƒÉ -> √Ænchidem meniul »ôi afi»ôƒÉm ghidul
    panel.classList.remove("open");
    btn.textContent = "‚ò∞ Menu";

    const guideBox = document.createElement("div");
    guideBox.id = "iosGuideBox";

    // mƒÉsurƒÉm √ÆnƒÉl»õimea nav-barului
    const navBar = document.querySelector(".nav-bar");
    const navHeight = navBar ? navBar.offsetHeight : 60;

    guideBox.innerHTML = `
      <div style="position:relative; padding:20px; background:#161a24; border:2px solid #2ff6de;
                  border-radius:14px; margin:0; margin-top:${navHeight + 10}px;
                  color:#f1f1f1; width:100%; box-sizing:border-box;">
        <button onclick="document.getElementById('iosGuideBox').remove(); 
                         document.getElementById('menuPanel').classList.add('open'); 
                         document.getElementById('menuToggle').textContent='‚úñ Close';" 
                style="position:absolute; top:10px; right:15px; background:none; border:none; color:#2ff6de; font-size:18px; cursor:pointer;">‚úñ</button>
        <h3 style="margin:0 0 10px 0;"> Add to Home Screen (iOS)</h3>
        <p>Follow these steps in <b>Google Chrome / Safari</b>:</p>
        <ol style="margin-left:20px; line-height:1.6;">
          <li>Tap <b>Share</b> ‚¨ÜÔ∏è (bottom bar).</li>
          <li>Scroll and select <b>Add to Home Screen</b>.</li>
          <li>Confirm with <b>Add</b>.</li>
        </ol>
        <img src="https://axel4ro.github.io/TCLexplorer/images/ios-add.png"
             alt="iOS Add to Home Screen tutorial"
             style="width:100%;border-radius:10px;margin-top:10px;">
      </div>`;

    navBar.insertAdjacentElement("afterend", guideBox);
  }
}

document.querySelectorAll('.live-dot').forEach(dot => {
  const random = 1.5 + Math.random(); // √Æntre 1.5s »ôi 2.5s
  dot.style.setProperty('--pulse-speed', `${random}s`);
});
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/68e759567914761952cb4c66/1j73r9ujm';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();

function showSubGuide(id) {
  // Ascunde pagina Web3 Guide
  document.getElementById("web3Guide").classList.remove("active");

  // AratƒÉ pagina selectatƒÉ (connectXportal sau redeemAlpha)
  document.querySelectorAll('.section-page').forEach(sec => sec.classList.remove('active', 'fullpage'));
  const sub = document.getElementById(id);
  if (sub) sub.classList.add("active");
}

// === TCL Rewards Live Data (APR, Emission, Staked) ===
const SC_ADDRESS = "erd1qqqqqqqqqqqqqpgqm77vv5dcqs6kuzhj540vf67f90xemypd0ufsygvnvk";
const CHARSET = "qpzry9x8gf2tvdw0s3jn54khce6mua7l";

function bech32Decode(bech) {
  bech = bech.toLowerCase();
  const pos = bech.lastIndexOf("1");
  const data = [];
  for (let i = pos + 1; i < bech.length; i++) {
    const v = CHARSET.indexOf(bech[i]);
    if (v === -1) return null;
    data.push(v);
  }
  return convertBits(data.slice(0, -6), 5, 8, false);
}

function convertBits(data, frombits, tobits, pad) {
  let acc = 0, bits = 0, ret = [];
  const maxv = (1 << tobits) - 1;
  for (let value of data) {
    if (value < 0 || (value >> frombits)) return null;
    acc = (acc << frombits) | value;
    bits += frombits;
    while (bits >= tobits) {
      bits -= tobits;
      ret.push((acc >> bits) & maxv);
    }
  }
  if (pad) {
    if (bits > 0) ret.push((acc << (tobits - bits)) & maxv);
  } else if (bits >= frombits || ((acc << (tobits - bits)) & maxv)) return null;
  return ret;
}

function bech32ToHex(bech) {
  const bytes = bech32Decode(bech);
  return bytes ? Array.from(bytes, b => b.toString(16).padStart(2, "0")).join("") : null;
}

async function loadTCLStats() {
  try {
    const hexAddr = bech32ToHex(SC_ADDRESS);
    const payload = { scAddress: SC_ADDRESS, funcName: "getRewardsData", args: [hexAddr] };
    const res = await fetch("https://api.multiversx.com/query", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!data.returnData || !data.returnData[0]) throw new Error("No return data");
    
    const decoded = atob(data.returnData[0]);
    const parts = decoded.split(" ");
    
    const apr = parseFloat(parts[2]).toFixed(2);
    const totalStakedRaw = parseFloat(parts[3]);
    const emissionRaw = parseFloat(parts[14]);

    // === TCL valori
    const totalStaked = totalStakedRaw / 1e18;
    const emission = emissionRaw / 1e18;

    // === Fetch pre»õul TCL live
    const priceRes = await fetch("https://api.dexscreener.io/latest/dex/pairs/multiversx/erd1qqqqqqqqqqqqqpgq6quepqlx66rmwst8uxl6p28jhcrnva982jpszqhxff");
    const priceData = await priceRes.json();
    const price = parseFloat(priceData.pair?.priceUsd || 0);

    // === Valori √Æn USD
    const stakedUsd = totalStaked * price;
    const emissionUsd = emission * price;

    // === Afi»ôare formatatƒÉ
    document.getElementById("apr").textContent = apr + "%";
    document.getElementById("staked").textContent = totalStaked.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " TCL";
    document.getElementById("emission").textContent = emission.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " TCL";
    document.getElementById("stakedUsd").textContent = "‚âà " + stakedUsd.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " $";
    document.getElementById("emissionUsd").textContent = "‚âà " + emissionUsd.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " $";
    document.getElementById("aprUsd").textContent = ""; // APR n-are valoare √Æn $
    document.getElementById("stakedMini").textContent = totalStaked.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " TCL";
	document.getElementById("stakedMiniUsd").textContent = "‚âà " + stakedUsd.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " $";
	document.getElementById("emissionMini").textContent = emission.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " TCL";
	document.getElementById("emissionMiniUsd").textContent = "‚âà " + emissionUsd.toLocaleString("en-US", { maximumFractionDigits: 2 }) + " $";

  } catch (e) {
    console.error("‚ö†Ô∏è Error loading TCL rewards:", e);
    document.getElementById("apr").textContent = "Error";
  }
}

loadTCLStats();
setInterval(loadTCLStats, 300000); // actualizare la 5 minute

function openAprCalculator() {
  document.getElementById("aprModal").style.display = "flex";
}

function closeAprCalculator() {
  document.getElementById("aprModal").style.display = "none";
}

// === Format input automat cu virgule ===
const aprInput = document.getElementById("aprInput");

aprInput.addEventListener("input", (e) => {
  let value = e.target.value.replace(/,/g, ""); // eliminƒÉm vechile virgule
  if (value === "") return;
  if (!/^\d+$/.test(value)) {
    e.target.value = e.target.value.replace(/[^\d,]/g, ""); // curƒÉ»õƒÉm caractere non-numerice
    return;
  }
  // formateazƒÉ dinamic √Æn stil englez (1,000,000)
  e.target.value = parseInt(value, 10).toLocaleString("en-US");
});

function simulateApr() {
  // scoatem virgulele pentru calcul
  const raw = aprInput.value.replace(/,/g, "");
  const input = parseFloat(raw);

  if (isNaN(input) || input <= 0) {
    document.getElementById("aprResult").innerHTML = "‚ö†Ô∏è Please enter a valid TCL amount.";
    return;
  }

  const totalStaked = parseFloat((document.getElementById("staked").textContent || "0").replace(/[^0-9.]/g, ""));
  const aprNow = parseFloat((document.getElementById("apr").textContent || "0").replace("%", ""));

  if (!totalStaked || !aprNow) {
    document.getElementById("aprResult").innerHTML = "‚ö†Ô∏è Live data not loaded yet.";
    return;
  }

  const newStaked = totalStaked + input;
  const newApr = (aprNow * totalStaked) / newStaked;

  const apr5 = newApr * 1.05;
  const apr7 = newApr * 1.07;
  const apr10 = newApr * 1.10;

  const formattedInput = input.toLocaleString("en-US");

  document.getElementById("aprResult").innerHTML = `
    <div>üí∞ Simulated amount: <b>${formattedInput}</b> TCL</div><br>
    <div>üìä New APR: <b>${newApr.toFixed(2)}%</b></div>
    <div>üöÄ With +5% boost: <b>${apr5.toFixed(2)}%</b></div>
    <div>‚ö° With +7% boost: <b>${apr7.toFixed(2)}%</b></div>
    <div>üî• With +10% boost: <b>${apr10.toFixed(2)}%</b></div>
  `;
}

</script>
</body>
</html>

