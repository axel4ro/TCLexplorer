<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.9" />
  <title>The Cursed Land - Wiki</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #161a24;
      color: #f1f1f1;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

.header {
  width: 100%;
  background: #161a24;
  padding: 12px 0;
  position: sticky;
  top: 0;
  left: 0;
  z-index: 1000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.header-inner {
  max-width: 1000px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 0 20px;
  box-sizing: border-box;
}

.back-btn {
  display: inline-block;
  padding: 10px 18px;             /* la fel ca Wiki/Menu */
  border-radius: 6px;
  background: #249c8c;
  color: white;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;

  /* üî• umbra textului »ôi a butonului */
  text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);

  transition: transform 0.2s, opacity 0.2s;
}

.back-btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}

/* üîπ Search box */
.search-box {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
}

#searchInput {
  flex: 1;
  max-width: 400px;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #333;
  background: #1e2230;
  color: #fff;
  font-size: 15px;
}
#searchInput:focus {
  outline: 2px solid #2ff6de;
}

.search-btn {
  padding: 8px 14px;
  border-radius: 8px;
  background: #2ff6de;
  color: #161a24;
  font-weight: 600;
  border: none;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  transition: transform 0.2s, opacity 0.2s;
}
.search-btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}

/* üîπ Con»õinut */
.content {
  max-width: 1000px;
  margin: 20px auto;
  padding: 0 20px;
}
h1 {
  color: #2ff6de;  /* culoarea ta de accent */
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 20px;

  /* üî• eviden»õiere text */
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9);

  /* linie subtilƒÉ dedesubt */
  border-bottom: 2px solid #249c8c;
  padding-bottom: 6px;
}

h1, h2 {
  color: #2ff6de;
  margin-bottom: 10px;
}

.card {
  background: #1e2230;
  border: 1px solid #333;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 18px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}

.card h2 {
  margin-top: 0;
}

a {
  color: #2ff6de;
  text-decoration: none;
  font-weight: 600;
}
a:hover {
  text-decoration: underline;
}

.toggle {
  background: #1e2230;
  border: 1px solid #333;
  border-radius: 8px;
  padding: 12px;
  margin: 12px 0;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  color: #2ff6de;
  transition: background 0.2s;
}
.toggle:hover {
  background: #2a2f42;
}
.toggle-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.toggle-header span {
  font-size: 18px;
  margin-left: 10px;
  transition: transform 0.2s;
}
.toggle.open .toggle-header span {
  transform: rotate(90deg);
}
.toggle p {
  color: #f1f1f1;
  margin: 6px 0 0 0;
  font-weight: normal;
}
.section-content {
  display: none;
  padding: 10px 14px;
}

/* üîπ Highlight la search */
.highlight {
  background: rgba(47,246,222,0.25);
  color: #2ff6de;
  font-weight: bold;
  padding: 0 2px;
  border-radius: 4px;
}
.desc-list {
  list-style: none;
  padding-left: 0;
  margin: 6px 0 0 0;
}
.desc-list li {
  margin: 4px 0;
}
.btn-link {
  display: inline-block;
  margin-top: 10px;
  padding: 8px 14px;
  border-radius: 8px;
  background: #2ff6de;
  color: #161a24;
  font-weight: 600;
  text-decoration: none;
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  transition: transform 0.2s, opacity 0.2s;
}
.btn-link:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}
/* üîπ Responsive */
@media (max-width: 600px) {
  .header-inner {
    flex-direction: column;
    align-items: stretch;
  }
  .search-box {
    width: 100%;
  }
  #searchInput {
    max-width: 100%;
  }
}

.lang-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  font-size: 14px;
  font-weight: 600;
  border-radius: 8px;
  border: 1px solid #2ff6de;
  background: #1e2230;
  color: #f1f1f1;
  cursor: pointer;
}
.lang-btn img { width: 20px; height: 14px; }

.lang-menu {
  display: none;
  position: absolute;
  right: 0;
  margin-top: 6px;
  background: #111827;
  border: 1px solid #2ff6de;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
  min-width: 160px;
  z-index: 2000;
}
.lang-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  font-size: 14px;
  cursor: pointer;
  color: #f1f1f1;
}
.lang-option:hover { background: #2ff6de33; }
.lang-dropdown.open .lang-menu { display: block; }

  </style>
</head>
<body>
<!-- üîô Header -->
<div class="header">
  <div class="header-inner">
    <a href="index.html" class="back-btn">‚¨ÖÔ∏è Back to TCL Explorer</a>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="üîç Search in Wiki..." onkeyup="searchWiki()" />
      <button class="search-btn" onclick="searchWiki()">Search</button>
    </div>

    <!-- üåç Dropdown pentru limbƒÉ -->
    <div class="lang-dropdown" style="margin-left:auto; position:relative;">
      <button class="lang-btn" id="currentLang">
        <img src="https://flagcdn.com/w20/gb.png" alt="EN"> English
      </button>
      <div class="lang-menu">
        <div class="lang-option" onclick="setLang('en')"><img src="https://flagcdn.com/w20/gb.png"> English</div>
        <div class="lang-option" onclick="setLang('ro')"><img src="https://flagcdn.com/w20/ro.png"> Rom√¢nƒÉ</div>
        <div class="lang-option" onclick="setLang('tr')"><img src="https://flagcdn.com/w20/tr.png"> T√ºrk√ße</div>
        <div class="lang-option" onclick="setLang('de')"><img src="https://flagcdn.com/w20/de.png"> Deutsch</div>
        <div class="lang-option" onclick="setLang('es')"><img src="https://flagcdn.com/w20/es.png"> Espa√±ol</div>
        <div class="lang-option" onclick="setLang('fr')"><img src="https://flagcdn.com/w20/fr.png"> Fran√ßais</div>
        <div class="lang-option" onclick="setLang('it')"><img src="https://flagcdn.com/w20/it.png"> Italiano</div>
        <div class="lang-option" onclick="setLang('pl')"><img src="https://flagcdn.com/w20/pl.png"> Polski</div>
        <div class="lang-option" onclick="setLang('pt')"><img src="https://flagcdn.com/w20/pt.png"> Portugu√™s</div>
      </div>
    </div>
  </div>
</div>

  <!-- üìñ Con»õinut Wiki -->
  <div class="content" id="wikiContent">
    <h1>üìñ The Cursed Land ‚Äì Wiki</h1>
    <p>‚è≥ Loading data...</p>
  </div>

<script>
let wikiData = {};
let searchQuery = "";
let currentLang = localStorage.getItem("lang") || "en"; 
const WIKI_BASE_URL = "https://axel4ro.github.io/TCLexplorer/lang";

  function goToPage(pageId) {
  // deschide direct index.html cu sec»õiunea doritƒÉ
  window.location.href = `index.html#${pageId}`;
}

// ‚úÖ func»õia highlight
function highlightText(text, query) {
  if (!query) return text;
  const regex = new RegExp(`(${query})`, "gi");
  return text.replace(regex, `<span class="highlight">$1</span>`);
}

// √éncarcƒÉ JSON
async function loadWiki(lang = "en", fallback = true) {
  try {
    const res = await fetch(`${WIKI_BASE_URL}/wiki_${lang}.json?t=${Date.now()}`);
    if (!res.ok) throw new Error("HTTP " + res.status);
    wikiData = await res.json();
    renderWiki(wikiData, false); // üî• ini»õial √Ænchise
  } catch (e) {
    console.error("Wiki load error", e);

    if (fallback && lang !== "en") {
      console.warn(`‚ö†Ô∏è Falling back to English...`);
      setLang("en"); // schimbƒÉm dropdown pe englezƒÉ
    } else {
      document.getElementById("wikiContent").innerHTML =
        `<p>‚ùå Failed to load Wiki data for lang: ${lang}</p>`;
    }
  }
}

// üî• versiune nouƒÉ renderWiki
function renderWiki(data, forceOpen = false) {
  const container = document.getElementById("wikiContent");
  container.innerHTML = "<h1>üìñ The Cursed Land ‚Äì Wiki</h1>";

  for (const [sectionName, sectionData] of Object.entries(data)) {
    if (!sectionData) continue;

    const sectionHasResults =
      (sectionData.list && sectionData.list.length > 0) ||
      (sectionData.categories && Object.keys(sectionData.categories).length > 0);

    container.innerHTML += `
      <div class="card toggle ${forceOpen && sectionHasResults ? "open" : ""}" 
           onclick="toggleSection('${sectionName}List', this)">
        <div class="toggle-header">
          <h2>üìÇ ${sectionName.charAt(0).toUpperCase() + sectionName.slice(1)}</h2>
          <span>${forceOpen && sectionHasResults ? "‚ñº" : "‚ñ∂"}</span>
        </div>
        <p>${highlightText(sectionData.info || "", searchQuery)}</p>
      </div>
      <div id="${sectionName}List" class="section-content" 
           style="display:${forceOpen && sectionHasResults ? "block" : "none"}"></div>
    `;
// üî• INSERAT SUB SECTIUNEA CLASSES
if (sectionName.toLowerCase() === "classes") {
    container.innerHTML += `
        <div class="card" onclick="window.location.href='loot.html'" 
             style="cursor:pointer; transition:background 0.2s;">
            <div class="toggle-header">
                <h2>üìä Drop Chance %</h2>
                <span>‚ñ∂</span>
            </div>

            <p>
                View all Items and Monsters - item drop percentages and loot tables.
            </p>
        </div>
    `;
}

    const secDiv = document.getElementById(`${sectionName}List`);

    // ‚úÖ LISTƒÇ SIMPLƒÇ (ex: races, classes, materials, etc.)
    if (sectionData.list) {
      sectionData.list.forEach(item => {
        let descHtml = "";

        // üîπ dacƒÉ are desc normal
        if (item.desc) {
          const lines = item.desc.split("\n");
          descHtml = "<ul class='desc-list'>" +
            lines.map(line => `<li>${highlightText(line, searchQuery)}</li>`).join("") +
            "</ul>";
        }

        // üîπ dacƒÉ are categorii (ex: Equipment Customization)
        if (item.categories) {
          let catHtml = "";
          for (const [catName, catData] of Object.entries(item.categories)) {
            const lines = catData.info.split("\n");
            const infoHtml = "<ul class='desc-list'>" +
              lines.map(line => `<li>${highlightText(line, searchQuery)}</li>`).join("") +
              "</ul>";
        
            // üî• aici decidem dacƒÉ subcategoria trebuie deschisƒÉ automat
            const isOpen = searchQuery && catData.info.toLowerCase().includes(searchQuery);
        
            catHtml += `
              <div class="card toggle ${isOpen ? "open" : ""}" onclick="toggleCategory('${item.name}-${catName}', this)">
                <div class="toggle-header">
                  <h3>${highlightText(catName, searchQuery)}</h3>
                  <span>${isOpen ? "‚ñº" : "‚ñ∂"}</span>
                </div>
                <div id="cat-${item.name}-${catName}" class="section-content" style="display:${isOpen ? "block" : "none"};">
                  ${infoHtml}
                </div>
              </div>
            `;
          }
          descHtml += catHtml;
        }


      secDiv.innerHTML += `
        <div class="card">
          <h2>${highlightText(item.name, searchQuery)}</h2>
          ${descHtml}
          ${item.link ? `<a href="${item.link}" class="btn-link">üåê View in TCL Explorer</a>` : ""}
          ${item.page ? `<button class="btn-link" onclick="goToPage('${item.page}')">üåê View in Explorer</button>` : ""}
        </div>
      `;
      });
    }

    // ‚úÖ CATEGORII DIRECTE (ex: bonuses)
    if (sectionData.categories) {
      for (const [catName, catData] of Object.entries(sectionData.categories)) {
        const catHasResults = catData.list && Object.keys(catData.list).length > 0;

        secDiv.innerHTML += `
          <div class="card toggle ${forceOpen && catHasResults ? "open" : ""}" 
               onclick="toggleCategory('${sectionName}-${catName}', this)">
            <div class="toggle-header">
              <h3>${highlightText(catName, searchQuery)}</h3>
              <span>${forceOpen && catHasResults ? "‚ñº" : "‚ñ∂"}</span>
            </div>
            <p>${highlightText(catData.info, searchQuery)}</p>
            <div id="cat-${sectionName}-${catName}" class="section-content" 
                 style="display:${forceOpen && catHasResults ? "block" : "none"}"></div>
          </div>
        `;

        const catDiv = document.getElementById(`cat-${sectionName}-${catName}`);
        for (const [bonus, values] of Object.entries(catData.list)) {
          catDiv.innerHTML += `<p><b>${highlightText(bonus, searchQuery)}:</b> ${values.join(", ")}</p>`;
        }
      }
    }
  }
}


// Toggle sec»õiuni
function toggleSection(id, el) {
  const section = document.getElementById(id);
  if (!section) return;
  if (section.style.display === "block") {
    section.style.display = "none";
    el.classList.remove("open");
  } else {
    section.style.display = "block";
    el.classList.add("open");
  }
}

function toggleCategory(cat, el) {
  const section = document.getElementById(`cat-${cat}`);
  if (!section) return;
  if (section.style.display === "block") {
    section.style.display = "none";
    el.classList.remove("open");
  } else {
    section.style.display = "block";
    el.classList.add("open");
  }
}
// Search
function searchWiki() {
  const query = document.getElementById("searchInput").value.toLowerCase();
  searchQuery = query;

  if (!query) {
    renderWiki(wikiData, false); // default: √Ænchise
    return;
  }

  const filtered = {};

  for (const [sectionName, sectionData] of Object.entries(wikiData)) {
    if (!sectionData) continue;

    // dacƒÉ are listƒÉ de iteme (about, races, classes etc.)
    if (sectionData.list) {
      const filteredList = sectionData.list.map(item => {
        let match = false;

        // verificƒÉ desc normal
        if (item.desc && item.desc.toLowerCase().includes(query)) {
          match = true;
        }

        // verificƒÉ numele
        if (item.name.toLowerCase().includes(query)) {
          match = true;
        }

        // verificƒÉ sub-categorii (ex: Equipment Customization)
        let matchedCategories = {};
        if (item.categories) {
          for (const [catName, catData] of Object.entries(item.categories)) {
            if (
              catName.toLowerCase().includes(query) ||
              catData.info.toLowerCase().includes(query)
            ) {
              match = true;
              matchedCategories[catName] = catData;
            }
          }
        }

        if (match) {
          // √Æntoarcem itemul filtrat (inclusiv doar categoriile relevante)
          return {
            ...item,
            categories: Object.keys(matchedCategories).length > 0 ? matchedCategories : item.categories
          };
        }
        return null;
      }).filter(Boolean);

      if (
        sectionData.info.toLowerCase().includes(query) ||
        filteredList.length > 0
      ) {
        filtered[sectionName] = {
          info: sectionData.info,
          list: filteredList
        };
      }
    }

    // dacƒÉ are categorii direct (ex: bonuses)
    if (sectionData.categories) {
      const categories = {};
      for (const [cat, obj] of Object.entries(sectionData.categories)) {
        const filteredList = Object.fromEntries(
          Object.entries(obj.list).filter(([bonus, values]) =>
            bonus.toLowerCase().includes(query) ||
            values.some(v => v.toString().toLowerCase().includes(query))
          )
        );

        if (
          cat.toLowerCase().includes(query) ||
          obj.info.toLowerCase().includes(query) ||
          Object.keys(filteredList).length > 0
        ) {
          categories[cat] = { info: obj.info, list: filteredList };
        }
      }

      if (
        sectionData.info.toLowerCase().includes(query) ||
        Object.keys(categories).length > 0
      ) {
        filtered[sectionName] = { info: sectionData.info, categories };
      }
    }
  }

  renderWiki(filtered, true); // üî• for»õƒÉm deschidere la rezultate
}

// ===== LimbƒÉ =====
const langDropdown = document.querySelector('.lang-dropdown');
const currentLangBtn = document.getElementById('currentLang');

currentLangBtn.addEventListener('click', () => {
  langDropdown.classList.toggle('open');
});

function setLang(lang) {
  langDropdown.classList.remove('open');
  localStorage.setItem("lang", lang);
  currentLang = lang;
  updateLangButton(lang);
  loadWiki(lang, true);
}

function updateLangButton(lang) {
  let label = "English", flag = "https://flagcdn.com/w20/gb.png";
  if (lang === "ro") { label = "Rom√¢nƒÉ"; flag = "https://flagcdn.com/w20/ro.png"; }
  if (lang === "tr") { label = "T√ºrk√ße"; flag = "https://flagcdn.com/w20/tr.png"; }
  if (lang === "de") { label = "Deutsch"; flag = "https://flagcdn.com/w20/de.png"; }
  if (lang === "es") { label = "Espa√±ol"; flag = "https://flagcdn.com/w20/es.png"; }
  if (lang === "fr") { label = "Fran√ßais"; flag = "https://flagcdn.com/w20/fr.png"; }
  if (lang === "it") { label = "Italiano"; flag = "https://flagcdn.com/w20/it.png"; }
  if (lang === "pl") { label = "Polski"; flag = "https://flagcdn.com/w20/pl.png"; }
  if (lang === "pt") { label = "Portugu√™s"; flag = "https://flagcdn.com/w20/pt.png"; }

  currentLangBtn.innerHTML = `<img src="${flag}" alt="${lang.toUpperCase()}"> ${label}`;
}
// üîπ Limbile suportate
const LANGS = [
  { code: "en", label: "English", flag: "gb" },
  { code: "ro", label: "Rom√¢nƒÉ", flag: "ro" },
  { code: "tr", label: "T√ºrk√ße", flag: "tr" },
  { code: "de", label: "Deutsch", flag: "de" },
  { code: "es", label: "Espa√±ol", flag: "es" },
  { code: "fr", label: "Fran√ßais", flag: "fr" },
  { code: "it", label: "Italiano", flag: "it" },
  { code: "pl", label: "Polski", flag: "pl" },
  { code: "pt", label: "Portugu√™s", flag: "pt" }
];

// üîπ VerificƒÉ dacƒÉ fi»ôierul JSON existƒÉ
async function checkLangFile(lang) {
  try {
    const res = await fetch(`${WIKI_BASE_URL}/wiki_${lang}.json`, { method: "HEAD" });
    return res.ok;
  } catch {
    return false;
  }
}

// üîπ Construie»ôte dropdown-ul dinamic
async function buildLangDropdown() {
  const menu = document.querySelector(".lang-menu");
  menu.innerHTML = ""; // curƒÉ»õƒÉm

  for (const lang of LANGS) {
    if (await checkLangFile(lang.code)) {
      const option = document.createElement("div");
      option.className = "lang-option";
      option.innerHTML = `<img src="https://flagcdn.com/w20/${lang.flag}.png"> ${lang.label}`;
      option.onclick = () => setLang(lang.code);
      menu.appendChild(option);
    }
  }
}

// ===== Detectare automatƒÉ la load =====
window.addEventListener("DOMContentLoaded", async () => {
  await buildLangDropdown(); // üåç construim dropdown doar cu limbile valide

  if (!localStorage.getItem("lang")) {
    let browserLang = navigator.language.toLowerCase();
    currentLang = LANGS.find(l => browserLang.startsWith(l.code))?.code || "en";
    localStorage.setItem("lang", currentLang);
  } else {
    currentLang = localStorage.getItem("lang");
  }

  updateLangButton(currentLang);
  loadWiki(currentLang);
});

// On load
window.onload = () => loadWiki(currentLang);

  <!--Start of Tawk.to Script-->

var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/68e759567914761952cb4c66/1j73r9ujm';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
<!--End of Tawk.to Script-->
  
</script>
</body>
</html>


